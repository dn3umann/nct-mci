---
title: NCT Research Code
output: 
  html_notebook:
---

```{=html}
<script src="/Users/daraneumann/Downloads/Research/NCT/Code/HighlightJS/highlight.js"> </script>
```
<link rel="stylesheet" href="/Users/daraneumann/Downloads/Research/NCT/Code/HighlightJS/styles/base16/humanoid-dark.css">

------------------------------------------------------------------------

------------------------------------------------------------------------

# Configuration

```{r Configuration}
base.directory="/Users/daraneumann/Downloads/Research/NCT/" #overall folder
data.dir="/Users/daraneumann/Downloads/Research/NCT/Data/"
results.dir="/Users/daraneumann/Downloads/Research/NCT/Results/"
figures.dir="/Users/daraneumann/Downloads/Research/NCT/Results/Figures/"
#xyz
```

```{r Packages, warning=FALSE}

library(R.matlab)
library(stringr)
library(viridis)
library("lattice")
library(robustbase)
library(matrixStats)
library(vioplot)
library(pracma)
library(gridExtra)
```

---
output: html_notebook
---

------------------------------------------------------------------------

# Data Validation

Initial time series data has 576 .txt files, but some are partially or completely composed of zeroes and need to be omitted from the data.

```{r DataValidation, warning=FALSE}

file.names=list.files("/Users/daraneumann/Downloads/Research/NCT/Data/TimeSeries")
length(file.names) #total number of subjects with time series data

```

```{r FindZeroes, warning=FALSE}

for(i in 1:length(file.names)){ #go through each file
  x=read.table(file.names[i],header=F,sep="",dec=".")
  if (all(x==0)) { #find the files where the time series is all zeroes
    print(paste((file.names[i]),"has no data.")) }
    else {
      if (any(x==0)) { #find the files where the time series has zeroes
      print(paste((file.names[i]),"has bad data.")) }}
}

```

**Files removed**:

[No Data]{.underline}

-   Ave200SchaeferTimeSeries_Luchsinger_900036 \_MRI_20190731.txt
-   Ave200SchaeferTimeSeries_Luchsinger_900040_MRI_20190726.txt
-   Ave200SchaeferTimeSeries_Luchsinger_900065_MRI_20191025.txt
-   Ave200SchaeferTimeSeries_Luchsinger_900089_MRI_20191220.txt
-   Ave200SchaeferTimeSeries_Luchsinger_900315_MRI_20190404.txt
-   Ave200SchaeferTimeSeries_Luchsinger_900318_MRI_20190416.txt

[Missing Data]{.underline}

-   Ave200SchaeferTimeSeries_Devanand_114_MRI_10-5-18.txt
-   Ave200SchaeferTimeSeries_Luchsinger\_ 900300_MRI\_ 20200929.txt
-   Ave200SchaeferTimeSeries_Luchsinger_900364_MRI_20190529.txt
-   Ave200SchaeferTimeSeries_Luchsinger_900403_MRI_20190806.txt

[Clustering Issues]{.underline}

-   Ave200SchaeferTimeSeries_Devanand_1022_MRI_6-24-21.txt
-   Ave200SchaeferTimeSeries_Luchsinger_800110_MRI_20190129.txt
-   Ave200SchaeferTimeSeries_Luchsinger_800351_MRI_20190905.txt
-   Ave200SchaeferTimeSeries_Luchsinger_900244_MRI_20190507.txt
-   Ave200SchaeferTimeSeries_Luchsinger_900277_MRI_20190205.txt
-   Ave200SchaeferTimeSeries_Luchsinger_900407_MRI_20190809.txt
-   Ave200SchaeferTimeSeries_Luchsinger_900423_MRI_20191018.txt
-   Ave200SchaeferTimeSeries_Luchsinger_900534_MRI_20210223.txt
-   Ave200SchaeferTimeSeries_NegativeBOLD_C00150_S001.txt

Above files were removed from the TimeSeries Folder.

------------------------------------------------------------------------

# Demographics

```{r DemographicData, echo=TRUE, eval=FALSE}

load(file="/Users/daraneumann/Downloads/Research/NCT/Demographics.RData")
frame.raw=as.data.frame(demo_FC_uppertri_FC_regional)
#convert from matrix to data frame

data.raw=lapply(frame.raw,unlist)
#convert data in the columns from a "list" format to vectors
#lapply applies the function to each list (column of data)
#unlist turns a list into a vector

str(data.raw) #confirm everything is a vector
data.raw$"Region 12" #confirm an example

region.names=c(1:200) #replace V6 with 1 for region 1
names(data.raw)=c('ID','Age','Sex','ICV','T1',region.names)

data.frame.raw=as.data.frame(data.raw)
data.frame.raw[,1] #subject IDs


removed.subject.IDs=c('900036','900040','900065','900089','900315','900318','114','900300','900364',
                      '900403','1022','800110','800351','900244','900277','900407','900423','900534','C00150','139','127','900134')

rows.to.remove=NULL #list of rows that correspond to the excluded subjects

for (subject in removed.subject.IDs){
  affected.row=which(data.frame.raw[,1]==subject)
  rows.to.remove=c(rows.to.remove,affected.row)
  cat("Row for subject ",subject,": ",affected.row,"\n")
}

data.frame=data.frame.raw[-rows.to.remove,] #create new data frame without the excluded subjects

data.frame$Status=ifelse(nchar(as.character(data.frame$ID)) %in% c(3,4),"MCI","HC")
#categories MCI and HC (MCI come from Devanand, which has ID lengths of 3 or 4)

data.frame$Study=ifelse(startsWith(data.frame$T1,"/bhii/qnl/studies/BHII"),"B",
                ifelse(startsWith(data.frame$T1,"/bhii/qnl/studies/CogRes"),"C",
                  ifelse(startsWith(data.frame$T1,"/bhii/qnl/studies/NegativeBOLD"),"N",
                    ifelse(startsWith(data.frame$T1,"/bhii/qnl/studies/Devanand"),"D",
                      ifelse(startsWith(data.frame$T1,"/bhii/qnl/studies/RANN"),"R",
                        ifelse(startsWith(data.frame$T1,"/bhii/qnl/studies/Luchsinger"),"L",0))))))

names(data.frame)=c("ID","Age","Sex","ICV","T1",region.names,"Status","Study")

data=lapply(data.frame,unlist) #create new frame of vectors without the excluded subjects

setwd("/Users/daraneumann/Downloads/Research/NCT/Data/")
save(data,file="Demographic.Data.RData")

```

```{r DemographicStatistics}

load(file="/Users/daraneumann/Downloads/Research/NCT/Data/Demographic.Data.RData")
dem.data=as.data.frame(data)
dem.data=dem.data[order(dem.data$T1,decreasing=FALSE),]

#age distribution
print(paste("Mean Age (All Subjects):",mean(dem.data$Age)))
print(paste("Mean Age (HC):",mean(subset(dem.data,Status=="HC")$Age)))
print(paste("Mean Age (MCI):",mean(subset(dem.data,Status=="MCI")$Age)))

#sex distribution; females = 1, males = 0
print(paste("Percent Female (All Subjects):",
            (100*(sum(dem.data$Sex==1)/nrow(dem.data)))))
print(paste("Percent Female (HC):",
            (100*(sum(subset(dem.data,Status=="HC")$Sex==1))/nrow(subset(dem.data,Status=="HC")))))
print(paste("Percent Female (MCI):",
            (100*(sum(subset(dem.data,Status=="MCI")$Sex==1))/nrow(subset(dem.data,Status=="MCI")))))

#ICV distribution
print(paste("Mean ICV (All Subjects):",mean(dem.data$ICV)))
print(paste("Mean ICV (HC):",mean(subset(dem.data,Status=="HC")$ICV)))
print(paste("Mean ICV (MCI):",mean(subset(dem.data,Status=="MCI")$ICV)))

```

```{r DemographicComparison, warning=FALSE}

#Wilcoxon rank-sum to compare age and ICV between HC and MCI
wilcox.test(Age~Status,data=dem.data)
wilcox.test(ICV~Status,data=dem.data)

#chi-square test to compare sex between HC and MCI
chisq.test(dem.data$Sex,dem.data$Status)

```

------------------------------------------------------------------------

# Z-Scored Time Series

Z-scoring carried out on a subject-wise level:

-   Each subject's time series is z-scored with respect to that individual time series
    -   This accounts for the different amplitudes of time series data among subjects

```{r UpdatedData, warning=FALSE}

file.names=list.files('/Users/daraneumann/Downloads/Research/NCT/Data/TimeSeries/')
length(file.names) #total number of subjects with usable data

```

```{r MatrixTS, warning=FALSE}

setwd('/Users/daraneumann/Downloads/Research/NCT/Data/TimeSeries/')
file.names=list.files('/Users/daraneumann/Downloads/Research/NCT/Data/TimeSeries')

time.series.matrix=NULL #initialize the matrix

for(i in 1:length(file.names)){ #go through files 1 through 554
  matrix.entry=as.matrix(read.table(file.names[i],header=F,sep="",dec="."))
  mean1=mean(matrix.entry)
  sd1=sd(matrix.entry)
  time.series.matrix.sub.level.zscore=(matrix.entry-mean1)/sd1
  time.series.matrix=rbind(time.series.matrix,t(time.series.matrix.sub.level.zscore))
  #assign matrix.entry to TS data in that specific file (data for one subject)
  #time.series.matrix=rbind(time.series.matrix,t(matrix.entry))
}

print('Dimensions of Matrix');dim(time.series.matrix)
# writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/AprilTimeSeriesZScored.mat",labpcexport=time.series.matrix)
```

-   Columns = 200 because there are 200 regions

-   Rows = number of subjects \* TS length = 211358 because each TS entry gets its own row in the column

-   TS entries is constant in the same subject for each region (i.e., 300 TS for each of the 200 regions). Thus, the number of rows under each column will end up being the same

```{r OldSubjectZScoredTS, warning=FALSE}

zcored.subject.TS.matrix=t(apply(time.series.matrix,1,function(row) scale(row,center=mean(row),scale=sd(row))))

```

```{r OldGlobalZScoredTS, warning=FALSE}

  #z-score with respect to the global mean and SD

dim(time.series.zscored)
  #same as zcored.subject.TS.matrix because it's just everything converted to z-score

setwd("/Users/daraneumann/Downloads/Research/NCT/Data/")
# save(time.series.zscored,file="/Users/daraneumann/Downloads/Research/NCT/Data/TimeSeriesZScored.RData")
load(file="/Users/daraneumann/Downloads/Research/NCT/Data/TimeSeriesZScored.RData")
# install.packages("R.matlab")
time.series.zscored=(zcored.subject.TS.matrix-mean(zcored.subject.TS.matrix))/sd(zcored.subject.TS.matrix)
# writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/TimeSeriesZScored.mat",labpcexport=time.series.zscored)

```

------------------------------------------------------------------------

# Clusters

In MATLAB:

-   Setup
-   Compute best number of clusters
-   Variance explained by clusters (figures)
-   Partitions and centroids

*Clusters*: 6

Figures for variance explained and gain in variance explained

------------------------------------------------------------------------

# Time Series Length

The length of the time series is not equal for all subjects (i.e., some have 300, others have 200, etc.), so the lengths must be put into a matrix.

```{r LengthTS, warning=FALSE}

file.names=list.files("/Users/daraneumann/Downloads/Research/NCT/Data/TimeSeries")
lengthTS=NULL

for(i in 1:length(file.names)){ #go through files 1 through 554
  setwd("/Users/daraneumann/Downloads/Research/NCT/Data/TimeSeries")
  subjectTS=read.table(file.names[i],header=F,sep="",dec=".")
  #assign subjectTS to TS data present in that specific file (data for one subject)
  lengthTS=rbind(lengthTS,ncol(subjectTS))
}

setwd("/Users/daraneumann/Downloads/Research/NCT/Data/")
save(lengthTS,file="LengthTS.RData")
load(file="LengthTS.RData") #install.packages("R.matlab")
writeMat("LengthTS.mat",labpcexport=lengthTS)

```

------------------------------------------------------------------------

# Transition Probabilities

In MATLAB:

-   Time series length
-   Transition probabilities

```{r TransitionProbability, warning=FALSE}

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/")
transition_prob=readMat('AprilTran.Prob.k6.ZS.TS.mat')$tran.prob
n=554

length(transition_prob)

transition_prob_persubject=NULL
for(i in 1:n){
  transition_prob_persubject=rbind(transition_prob_persubject,as.numeric(transition_prob[[i]][[1]]))
}

dim(transition_prob_persubject)

```

------------------------------------------------------------------------

# Structural Connectivity

```{r SC, warning=FALSE}

setwd("/Users/daraneumann/Downloads/Research/NCT/Data") #scmean_schaefer200_sdstream_sift2_volnorm_716subj.mat

sc_sdstream_schaefer200_716subj_volnorm=readMat("SC.mat")$labpcexport
#the given data is the average matrix with diag0

SC_matrix=sc_sdstream_schaefer200_716subj_volnorm

dim(SC_matrix)
SC_matrix[1:5,1:5] #view first 5 rows and first 5 columns

sc_sdstream_schaefer200_716subj_SCmatrix_diag0=SC_matrix

setwd("/Users/daraneumann/Downloads/Research/NCT/Data/")
writeMat("SC.Matrix.diag0.mat",labpcexport=sc_sdstream_schaefer200_716subj_SCmatrix_diag0)

```

------------------------------------------------------------------------

# Optimal T

In MATLAB:

-   Centroids for all patients
-   Find best T

*Best T*: 0.001

```{r BestT, warning=FALSE}

setwd("/Users/daraneumann/Downloads/Research/NCT/Results")

E_Full_T_All=readMat("AprilE.Full.T.k6.SC.Diag0.c1.mat")$E.full.T.k6.SC.Diag0.c1

head(cbind(rank(colMeans(transition_prob_persubject)),
    (colMeans(transition_prob_persubject))))

cor_energy=NULL
pvals_energy=NULL

for(t in 1:20){
  cor.entry=cor.test(rank(colMeans(transition_prob_persubject)),
                     rank(E_Full_T_All[t,]),method="spearman")
  cor_energy=rbind(cor_energy,cor.entry$estimate) #get each correlation coefficient
  pvals_energy=rbind(pvals_energy,cor.entry$p.value) #get p-values for each coefficient
}

print(cat("Correlation Coefficients:",head(cor_energy)))
print(cat("p-values:",head(pvals_energy)))

which.max(abs(cor_energy))
best_t=seq(0.001,10,0.5)[which.max(abs(cor_energy))]
best_t_index=which.max(abs(cor_energy))
print(paste("Best T:",best_t))

```

Create a graph

```{r GraphT, warning=FALSE}

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures")
pdf(file="April.Correlation.vs.T.k6.centroid.SCdiag0.pdf",width=14,height=8)
plot(seq(0.001,10,0.5),abs(cor_energy),type="b",
ylab="Amplitude of the correlation (k = 6)",xaxt="none",xlab="t")
axis(1,seq(0.001,10,0.5))
dev.off()

```

------------------------------------------------------------------------

# Control Energy

In MATLAB:

-   Control energy

------------------------------------------------------------------------

# Entropy

```{r SetEntropyID}

for (i in 1:557){
  if(startsWith(file.names[i],"Ave200SchaeferTimeSeries_BHII_")){
    file.names[i]=substr(file.names[i],31,36)
  } else {
    if(startsWith(file.names[i],"Ave200SchaeferTimeSeries_CogRes")){
    file.names[i]=substr(file.names[i],33,41)
    } else {
      if(startsWith(file.names[i],"Ave200SchaeferTimeSeries_NegativeBOLD_")){
        file.names[i]=substr(file.names[i],39,44)
      } else {
        if(startsWith(file.names[i],"Ave200SchaeferTimeSeries_Devanand_")){
        file.names[i]=gsub("_","",(substr(file.names[i],35,38)))
        } else {
          if(startsWith(file.names[i],"Ave200SchaeferTimeSeries_RANN_")){
          file.names[i]=substr(file.names[i],31,39)
          } else {
            if(startsWith(file.names[i],"Ave200SchaeferTimeSeries_Luchsinger_")){
            file.names[i]=substr(file.names[i],37,42)
            } else {
              print(file.names[i])
            }
          }
        }
      }
    }
  }
}

ID.timeseries=unique(substr(file.names,1,10)) #give each file its own ID

```

```{r Entropy, warning=FALSE}

setwd("/Users/daraneumann/Downloads/Research/NCT/Data/TimeSeries")

n=554 #number of subjects
regions=200 #number of regions

entropy=matrix(NA,ncol=regions,nrow=n)

k=1
for(i in 1:n){cat(k)
  timeseries=t(read.table(file.names[i],header=F,sep="",dec="."));dim(timeseries)
  for(region in 1:(dim(timeseries)[2])){
    timeseries1=timeseries[,region]
    entropy[k,region]=sample_entropy(timeseries1[-c(1:10)], edim = 2)
  }
  k=k+1
}
dim(entropy)

setwd("/Users/daraneumann/Downloads/Research/NCT/Results")
# save(entropy,file="Entropy.RData")
load(file="/Users/daraneumann/Downloads/Research/NCT/Results/Entropy.RData")

```

In MATLAB:

-   Visualize regional entropy

------------------------------------------------------------------------

# PET

```{r SetTauID}

raw.tau=read.csv("/Users/daraneumann/Downloads/Research/NCT/Data/Tau.csv")
raw.tau=raw.tau[,-1] #remove first column
names(raw.tau)[1]="ID" #rename new first column to "ID"

for (i in 1:628){
  if(startsWith(raw.tau$ID[i],"/bhii/qnl/studies/BHII")){
    raw.tau$ID[i]=substr(raw.tau$ID[i],33,38)
  } else {
    if(startsWith(raw.tau$ID[i],"/bhii/qnl/studies/CogRes")){
    raw.tau$ID[i]=substr(raw.tau$ID[i],35,43)
    } else {
      if(startsWith(raw.tau$ID[i],"/bhii/qnl/studies/NegativeBOLD")){
        raw.tau$ID[i]=substr(raw.tau$ID[i],41,46)
      } else {
        if(startsWith(raw.tau$ID[i],"/bhii/qnl/studies/Devanand")){
        raw.tau$ID[i]=gsub("/","",(substr(raw.tau$ID[i],37,40)))
        } else {
          if(startsWith(raw.tau$ID[i],"/bhii/qnl/studies/RANN")){
          raw.tau$ID[i]=substr(raw.tau$ID[i],33,41)
          } else {
            if(startsWith(raw.tau$ID[i],"/bhii/qnl/studies/Luchsinger")){
            raw.tau$ID[i]=substr(raw.tau$ID[i],39,44)
            } else {
              print(raw.tau$ID[i])
            }
          }
        }
      }
    }
  }
}

```

```{r SetPlaqueID}

raw.plaque=read.csv("/Users/daraneumann/Downloads/Research/NCT/Data/Plaques.csv")
names(raw.plaque)[1]="ID" #rename first column to "ID"

for (i in 1:628){
  if(startsWith(raw.plaque$ID[i],"/bhii/qnl/studies/BHII")){
    raw.plaque$ID[i]=substr(raw.plaque$ID[i],33,38)
  } else {
    if(startsWith(raw.plaque$ID[i],"/bhii/qnl/studies/CogRes")){
    raw.plaque$ID[i]=substr(raw.plaque$ID[i],35,43)
    } else {
      if(startsWith(raw.plaque$ID[i],"/bhii/qnl/studies/NegativeBOLD")){
        raw.plaque$ID[i]=substr(raw.plaque$ID[i],41,46)
      } else {
        if(startsWith(raw.plaque$ID[i],"/bhii/qnl/studies/Devanand")){
        raw.plaque$ID[i]=gsub("/","",(substr(raw.plaque$ID[i],37,40)))
        } else {
          if(startsWith(raw.plaque$ID[i],"/bhii/qnl/studies/RANN")){
          raw.plaque$ID[i]=substr(raw.plaque$ID[i],33,41)
          } else {
            if(startsWith(raw.plaque$ID[i],"/bhii/qnl/studies/Luchsinger")){
            raw.plaque$ID[i]=substr(raw.plaque$ID[i],39,44)
            } else {
              print(raw.plaque$ID[i])
            }
          }
        }
      }
    }
  }
}

```

```{r TauPlaqueFilter}

load(file="/Users/daraneumann/Downloads/Research/NCT/Data/Demographic.Data.RData")
dem.data=as.data.frame(dem.data)

tau=raw.tau[raw.tau$ID %in% dem.data$ID,] #only use subjects that were used for the other analyses
tau=tau[match(dem.data$ID,tau$ID),]
dim(tau) #should match number of subjects and numbers of regions

plaque=raw.plaque[raw.plaque$ID %in% dem.data$ID,]
plaque=plaque[match(dem.data$ID,plaque$ID),]
dim(plaque)

```

------------------------------------------------------------------------

# Results

## State-wise

-   `TStateCE`: analysis using t-test
-   `ANOVAStateCE`: analysis using ANCOVA

```{r TStateCE, warning=FALSE}

load(file="/Users/daraneumann/Downloads/Research/NCT/Data/Demographic.Data.RData") #import demographic data
setwd("/Users/daraneumann/Downloads/Research/NCT/Results/")

minimumcontrolenergy=readMat("/Users/daraneumann/Downloads/Research/NCT/Results/AprilMinimum.Control.Energy.mat")$minimumcontrolenergy #import minimum CE

dim(minimumcontrolenergy) #dimensions are 554 x 36

minimum.CE.t.test.MCI.HC=NULL

for(i in 1:36){ #compare for 6x6 clusters
  t.test.entry=t.test(minimumcontrolenergy[which(dem.data$Status=="MCI"),i], #t-test assumes MCI > HC
                      minimumcontrolenergy[which(dem.data$Status=="HC"),i])
  minimum.CE.t.test.MCI.HC=rbind(minimum.CE.t.test.MCI.HC,c(t.test.entry$statistic,t.test.entry$p.value))
}

print(minimum.CE.t.test.MCI.HC[1:5,])

p.adjust(minimum.CE.t.test.MCI.HC[,2],n=36,method="BH") #adjust p-values

print(paste("Number of transitions that are significantly different between HC and MCI: ",
            length(which(p.adjust(minimum.CE.t.test.MCI.HC[,2],n=36,method="BH")<0.05)))) #find significant p-values

```

```{r TStateCET1, warning=FALSE}

load(file="/Users/daraneumann/Downloads/Research/NCT/Data/Demographic.Data.RData") #import demographic data
setwd("/Users/daraneumann/Downloads/Research/NCT/Results/")

minimumcontrolenergyt1=readMat("/Users/daraneumann/Downloads/Research/NCT/Results/AprilMinimum.Control.Energy.T1.mat")$minimumcontrolenergy #import minimum CE

dim(minimumcontrolenergyt1) #dimensions are 554 x 36

minimum.CE.t.test.MCI.HC=NULL

for(i in 1:36){ #compare for 6x6 clusters
  t.test.entry=t.test(minimumcontrolenergyt1[which(dem.data$Status=="MCI"),i], #t-test assumes MCI > HC
                      minimumcontrolenergyt1[which(dem.data$Status=="HC"),i])
  minimum.CE.t.test.MCI.HC=rbind(minimum.CE.t.test.MCI.HC,c(t.test.entry$statistic,t.test.entry$p.value))
}

print(minimum.CE.t.test.MCI.HC[1:5,])

p.adjust(minimum.CE.t.test.MCI.HC[,2],n=36,method="BH") #adjust p-values

print(paste("Number of transitions that are significantly different between HC and MCI T=1: ",
            length(which(p.adjust(minimum.CE.t.test.MCI.HC[,2],n=36,method="BH")<0.05)))) #find significant p-values

```

```{r ANOVAStateCE, warning=FALSE}

load(file="/Users/daraneumann/Downloads/Research/NCT/Data/Demographic.Data.RData") #import demographic data
setwd("/Users/daraneumann/Downloads/Research/NCT/Results/")

minimumcontrolenergy=readMat("/Users/daraneumann/Downloads/Research/NCT/Results/AprilMinimum.Control.Energy.mat")$minimumcontrolenergy #import minimum CE

dim(minimumcontrolenergy) #dimensions are 554 x 36

CE.anova=NULL

for(i in 1:36){ #compare for 6x6 clusters
  anova.entry=summary(aov((minimumcontrolenergy)[,i]~Status+Sex+Age+ICV,data=dem.data))
  results.anova=as.data.frame(anova.entry[[1]])
  CE.anova=rbind(CE.anova,c(results.anova$'F value'[1],results.anova$'Pr(>F)'[1]))
}

print(CE.anova[1:5,])

significant.p.values=which(p.adjust(CE.anova[,2],n=36,method="BH")<0.05) #find significant p-values

print(paste("Transitions that are significantly different between HC and MCI: ",toString(significant.p.values)))

```

```{r ANOVAStateCET1, warning=FALSE}

load(file="/Users/daraneumann/Downloads/Research/NCT/Data/Demographic.Data.RData") #import demographic data
setwd("/Users/daraneumann/Downloads/Research/NCT/Results/")

minimumcontrolenergyt1=readMat("/Users/daraneumann/Downloads/Research/NCT/Results/AprilMinimum.Control.Energy.T1.mat")$minimumcontrolenergy #import minimum CE

dim(minimumcontrolenergyt1) #dimensions are 554 x 36

CE.anova=NULL

for(i in 1:36){ #compare for 6x6 clusters
  anova.entry=summary(aov((minimumcontrolenergyt1)[,i]~Status+Sex+Age+ICV,data=dem.data))
  results.anova=as.data.frame(anova.entry[[1]])
  CE.anova=rbind(CE.anova,c(results.anova$'F value'[1],results.anova$'Pr(>F)'[1]))
}

print(CE.anova[1:5,])

significant.p.values=which(p.adjust(CE.anova[,2],n=36,method="BH")<0.05) #find significant p-values

print(paste("Transitions that are significantly different between HC and MCI T=1: ",toString(significant.p.values)))

```

#### Radial Plots

```{r OldRadialPlots, warning=FALSE}

setwd("/Users/daraneumann/Downloads/Research/NCT/Code/EnergyLandscape/data")

sch.232.yeo=as.numeric(read.table("sch232_to_yeo.csv",sep=",",header=FALSE))
sch.200.yeo=sch.232.yeo[1:200] #last 32 regions are subcortex

Centroids.k6.ZS.TS=readMat('/Users/daraneumann/Downloads/Research/NCT/Results/Centroids.k6.ZScored.TS.mat')$Centroids.k6.ZS.TS
dim(Centroids.k6.ZS.TS)

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create files for radial plots
radial.plots=c("RadialPlot.k6.Centroid.1.pdf",
               "RadialPlot.k6.Centroid.2.pdf",
               "RadialPlot.k6.Centroid.3.pdf",
               "RadialPlot.k6.Centroid.4.pdf",
               "RadialPlot.k6.Centroid.5.pdf",
               "RadialPlot.k6.Centroid.6.pdf")

k=6 #number of clusters
networknames=c("Vis","SomMot","DorsAttn","SalVentAttn","Limbic","Cont","DMN")

for(clusternumber in 1:k){cat(clusternumber)
  
  ZS.Centroids.Cluster.k=Centroids.k6.ZS.TS[,clusternumber]
  
  ZS.Positive.Centroids.Cluster.k=replace(ZS.Centroids.Cluster.k,which(ZS.Centroids.Cluster.k<0),0)
  ZS.Negative.Centroids.Cluster.k=replace(ZS.Centroids.Cluster.k,which(ZS.Centroids.Cluster.k>0),0)
  
  Positive.Centroid.Cluster.k=NULL
  Negative.Centroid.Cluster.k=NULL
  
  for(i in c(1,2,3,4,5,6,7)){
    Positive.Centroid.Cluster.k=rbind(Positive.Centroid.Cluster.k,
                                      mean(ZS.Positive.Centroids.Cluster.k[which(sch.200.yeo==i)]))
    Negative.Centroid.Cluster.k=rbind(Negative.Centroid.Cluster.k,
                                      mean(ZS.Negative.Centroids.Cluster.k[which(sch.200.yeo==i)]))
  }
  
  cbind(Positive.Centroid.Cluster.k/max(Positive.Centroid.Cluster.k),
        Negative.Centroid.Cluster.k/(max(abs(Negative.Centroid.Cluster.k))))
  
  cbind(Positive.Centroid.Cluster.k,Negative.Centroid.Cluster.k)
  maxvalue=max(max(Positive.Centroid.Cluster.k),max(abs(Negative.Centroid.Cluster.k)));maxvalue
  
  maxvalue.chart=1.2 #upper bound of the plot
    #can change but must be the same for all clusters
    #must be greater than the highest maxvalue across all clusters (which is how you choose maxvalue.chart)
  
  
  library(fmsb)
  
  #Create a data frame with the following parameters
    #columns: correspond to each network
    #row 1: defines the upper bound of the chart (constant for all clusters; basically the scale)
    #row 2: defines lower bound of the chart (zero)
    #row 3: average value of the positive centroids for each network
    #row 4: average value of the negative centroids for each network
  
  data=as.data.frame(rbind(as.numeric(Positive.Centroid.Cluster.k), #row 3
                           as.numeric(abs(Negative.Centroid.Cluster.k))),ncol=7) #row 4 
  colnames(data)=c("Visual","Somatomotor","Dorsal Attention","Salient Ventral Attention",
                   "Limbic","Control","Default") #columns
  data=rbind(rep(maxvalue.chart,k),rep(0,k),data) #row 1 and row 2
  

  #Determine which network corresponds to each cluster
  most.positive=colnames(data)[which.max(data[3,])]
  most.negative=colnames(data)[which.max(data[4,])]
  if(most.positive>most.negative){ #determine which network has the highest overall
    highest.value=paste(most.positive,"(+)")
  } else {
    highest.value=paste(most.negative,"(-)")
  }
  
  results=NULL
  results=c(results,paste("\nCluster",clusternumber,"Network:",highest.value,
              "\nCluster",clusternumber,"High Amplitude Network:",most.positive,
              "\nCluster",clusternumber,"Low Amplitude Network:",most.negative,"\n",collapse="\n"))
  cat(results)
  
  pdf(file=radial.plots[[clusternumber]],width=18,height=12)
  par(mar=c(5,5,5,5));par(mfrow=c(1,1))
  
  library(fmsb)
  radarchart(data,
             axistype=1,
             pcol=c("magenta","blue"),
             plwd=4,
             plty=1,
             cglcol="darkgrey",
             cglty=1,
             axislabcol="black",
             caxislabels=seq(0,1.2,0.3),calcex=1.5,
             vlabels=c("Vis","SomMot","DorsAttn","SalVentAttn","Limbic","Cont","Def"),vlcex=1.5)
  dev.off()
}
```

```{r NewRadialPlots, warning=FALSE}

library(fmsb)
newradarchart=function(data,color="#00AFBB",vlabels=colnames(data),vlcex=5,caxislabels=NULL,title=NULL, ...){
  
  radarchart(data,
    axistype=1, #customize polygon
    pcol=color,pfcol=scales::alpha(color,0.5),plwd=2,plty=1, #customize grid
    cglcol="grey",cglty=1,cglwd=3, #customize axis
    axislabcol="grey2", #labels for variables
    vlcex=vlcex,vlabels=vlabels,
    caxislabels=caxislabels,title=title, ...
  )
}

setwd("/Users/daraneumann/Downloads/Research/NCT/Code/EnergyLandscape/data")

sch.232.yeo=as.numeric(read.table("sch232_to_yeo.csv",sep=",",header=FALSE))
sch.200.yeo=sch.232.yeo[1:200] #last 32 regions are subcortex

Centroids.k6.ZS.TS=readMat('/Users/daraneumann/Downloads/Research/NCT/Results/AprilCentroids.k6.ZScored.TS.mat')$Centroids.k6.ZS.TS
dim(Centroids.k6.ZS.TS)

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create files for radial plots
radial.plots=c("AprilRadialPlot.Centroid.1.pdf",
               "AprilRadialPlot.Centroid.2.pdf",
               "AprilRadialPlot.Centroid.3.pdf",
               "AprilRadialPlot.Centroid.4.pdf",
               "AprilRadialPlot.Centroid.5.pdf",
               "AprilRadialPlot.Centroid.6.pdf")

k=6 #number of clusters
networknames=c("Vis","SomMot","DorsAttn","SalVentAttn","Limbic","Cont","DMN")

for(clusternumber in 1:k){cat(clusternumber)
  
  ZS.Centroids.Cluster.k=Centroids.k6.ZS.TS[,clusternumber]
  
  ZS.Positive.Centroids.Cluster.k=replace(ZS.Centroids.Cluster.k,which(ZS.Centroids.Cluster.k<0),0)
  ZS.Negative.Centroids.Cluster.k=replace(ZS.Centroids.Cluster.k,which(ZS.Centroids.Cluster.k>0),0)
  
  Positive.Centroid.Cluster.k=NULL
  Negative.Centroid.Cluster.k=NULL
  
  for(i in c(1,2,3,4,5,6,7)){
    Positive.Centroid.Cluster.k=rbind(Positive.Centroid.Cluster.k,
                                      mean(ZS.Positive.Centroids.Cluster.k[which(sch.200.yeo==i)]))
    Negative.Centroid.Cluster.k=rbind(Negative.Centroid.Cluster.k,
                                      mean(ZS.Negative.Centroids.Cluster.k[which(sch.200.yeo==i)]))
  }
  
  cbind(Positive.Centroid.Cluster.k/max(Positive.Centroid.Cluster.k),
        Negative.Centroid.Cluster.k/(max(abs(Negative.Centroid.Cluster.k))))
  
  cbind(Positive.Centroid.Cluster.k,Negative.Centroid.Cluster.k)
  maxvalue=max(max(Positive.Centroid.Cluster.k),max(abs(Negative.Centroid.Cluster.k)));maxvalue
  
  Positive.Centroid=Positive.Centroid.Cluster.k/maxvalue #normalize so that each value has a scale 0-1
  Negative.Centroid=Negative.Centroid.Cluster.k/maxvalue #normalize so that each value has a scale 0-1
  
  maxvalue.chart=1 #upper bound of the plot
  
  #Create a data frame with the following parameters
    #columns: correspond to each network
    #row 1: defines the upper bound of the chart (constant for all clusters; basically the scale)
    #row 2: defines lower bound of the chart (zero)
    #row 3: average value of the positive centroids for each network
    #row 4: average value of the negative centroids for each network
  
  data=as.data.frame(rbind(as.numeric(Positive.Centroid), #row 3
                           as.numeric(abs(Negative.Centroid))),ncol=7) #row 4 
  colnames(data)=c("Visual","Somatomotor","Dorsal Attention","Salient Ventral Attention",
                   "Limbic","Control","Default") #columns
  data=rbind(rep(maxvalue.chart,k),rep(0,k),data) #row 1 and row 2
  

  #Determine which network corresponds to each cluster
  most.positive=colnames(data)[which.max(data[3,])]
  most.negative=colnames(data)[which.max(data[4,])]
  if(max(data[3,])>max(data[4,])){ #determine which network has the highest overall
    highest.value=paste(most.positive,"(+)")
  } else {
    highest.value=paste(most.negative,"(-)")
  }
  
  results=NULL
  results=c(results,paste("\nCluster",clusternumber,"Network:",highest.value,
              "\nCluster",clusternumber,"High Amplitude Network:",most.positive,
              "\nCluster",clusternumber,"Low Amplitude Network:",most.negative,"\n",collapse="\n"))
  cat(results)
  
  pdf(file=radial.plots[[clusternumber]],width=18,height=12)
  par(mar=c(5,5,5,5));par(mfrow=c(1,1))
  
  library(fmsb)
  newradarchart(data=data,
             color=c("#FFC300","purple"),
             vlabels=c("VIS","SMN","DAN","VAN","LIM","FPN","DMN"),vlcex=3,
             caxislabels=c(paste(0,"  "),
                           paste(0.25,"  "),
                           paste(0.5,"  "),
                           paste(0.75,"  "),
                           paste(1,"  ")),
             calcex=2)
             #caxislabels=seq(0,1,0.25),calcex=1)
  dev.off()
} 

```

```         
Cluster 1 Network: Limbic (-) 
Cluster 1 High Amplitude Network: Dorsal Attention 
Cluster 1 Low Amplitude Network: Limbic 
2
Cluster 2 Network: Somatomotor (-) 
Cluster 2 High Amplitude Network: Default 
Cluster 2 Low Amplitude Network: Somatomotor 
3
Cluster 3 Network: Visual (-) 
Cluster 3 High Amplitude Network: Limbic 
Cluster 3 Low Amplitude Network: Visual 
4
Cluster 4 Network: Visual (+) 
Cluster 4 High Amplitude Network: Visual 
Cluster 4 Low Amplitude Network: Limbic 
5
Cluster 5 Network: Somatomotor (+) 
Cluster 5 High Amplitude Network: Somatomotor 
Cluster 5 Low Amplitude Network: Default 
6
Cluster 6 Network: Limbic (+) 
Cluster 6 High Amplitude Network: Limbic 
Cluster 6 Low Amplitude Network: Dorsal Attention 
```

#### Heat Maps

-   `StatePlotTlm`: heat map that uses t-statistic values and lm estimates
-   `StatePlotANOVA`: heat map that uses F-values from ANCOVA
-   `StatePlotHC`: heat map of average state CE values for HC
-   `StatePlotMCI`: heat map of average state CE values for MCI

```{r OldStatePlotT, warning=FALSE}

setwd("/Users/daraneumann/Downloads/Research/NCT/Results")
# load(file="Entropy.RData")

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/")
pdf(file="Statewise.CE.Comparison.pdf",width=9,height=8)
  
max(minimum.CE.t.test.MCI.HC[,1])
min(minimum.CE.t.test.MCI.HC[,1])
  
at1=seq(-4.18,4.18,length.out=200)
rwb=colorRampPalette(colors=c("blue","purple","yellow"))
col1=rwb(200)
  
networks=c("Limbic (-)","SomMotor (-)","Visual (-)",
           "Visual (+)","SomMotor (+)","Limbic (+)") #change based on previous results
matrix=matrix((minimum.CE.t.test.MCI.HC[,1]),6,6)
  
  
ordered.networks=c("Limbic (+)","Limbic (-)","SomMotor (+)",
                   "SomMotor (-)","Visual (+)","Visual (-)")
ordered.matrix=matrix[c(6,1,5,2,4,3),c(6,1,5,2,4,3)] #change based on previous results
  
plot=levelplot(ordered.matrix,col.regions=col1,main="MCI > HC",xlab="",ylab="",scales=list(x=list(at=seq(1,6),labels=ordered.networks),y=list(at=seq(1,6),labels=ordered.networks)));plot #omit scales argument if networks are not yet known

```

```{r Seismic Color Map, warning=FALSE}

library(RColorBrewer)

seismic=read.csv("seismic_colormap.csv",header=FALSE)
seismic=as.matrix(seismic)
seismic.hex=rgb(seismic[,1],seismic[,2],seismic[,3])

```

```{r StatePlotTlm, warning=FALSE}

library(RColorBrewer)

load(file="/Users/daraneumann/Downloads/Research/NCT/Data/Demographic.Data.RData") #import demographic data
setwd("/Users/daraneumann/Downloads/Research/NCT/Results/")

minimumcontrolenergy=readMat("/Users/daraneumann/Downloads/Research/NCT/Results/AprilMinimum.Control.Energy.mat")$minimumcontrolenergy #import minimum CE

dim(minimumcontrolenergy) #dimensions are 554 x 36

CE.t.test=NULL
lm.state.TE.estimate=NULL
lm.entry=NULL
lm.state.TE.pvalue=NULL

for(i in 1:36){ #compare for 6x6 clusters
  t.test.entry=t.test(minimumcontrolenergy[which(dem.data$Status=="MCI"),i], #t-test assumes MCI>HC
                      minimumcontrolenergy[which(dem.data$Status=="HC"),i])
  CE.t.test=rbind(CE.t.test,c(t.test.entry$statistic,t.test.entry$p.value))
  
  lm.entry=summary(lm(minimumcontrolenergy[,i]~Status+Sex+Age+ICV,data=dem.data))
  lm.state.TE.estimate=rbind(lm.state.TE.estimate,lm.entry$coefficients[2,1])
  lm.state.TE.pvalue=rbind(lm.state.TE.pvalue,lm.entry$coefficients[2,4])
}

adjusted.lm.state.TE.pvalue=p.adjust(lm.state.TE.pvalue,n=36,method="BH")
lm.state.TE.pvalue
adjusted.lm.state.TE.pvalue
  
  
setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create heatmap
png(file="AprilStatewise.Comparison.lm.png",width=800,height=600)

networks=c("DorsAttn (+)","Default (+)","Default (-)",
           "DorsAttn (-)", "Visual (-)","Visual (+)") #change based on previous results

#matrix=matrix((CE.t.test[,1]),6,6) #plot with t-test estimates
matrix=matrix(lm.state.TE.estimate,6,6) #plot with lm estimates
  
ordered.networks=c("DAN (+)","DAN (-)","DMN (+)",
                   "DMN (-)","VIS (+)","VIS (-)")

ordered.matrix=matrix[c(1,4,2,3,6,5),c(1,4,2,3,6,5)] #change based on previous results

plot=levelplot(t(ordered.matrix),
               #col.regions=colorRampPalette(turbo(200)), #color palette and how many sub-colors
               col.regions=colorRampPalette(rev(brewer.pal(11,"RdBu"))),
               #col.regions=seismic.hex,
               colorkey=list(space="left"), #location of color key
               at=seq(-71.6,71.6,length.out=100),
               main="Comparison of State-Wise Transition Energy using lm Estimate (MCI > HC)",
               xlab="",ylab="",
               scales=list(x=list(at=seq(1,6),labels=ordered.networks,cex=1.5,font=2),
                           y=list(at=seq(1,6),labels=ordered.networks,cex=1.5,font=2)));plot #omit scales argument if networks are not yet known

```

```{r StatePlotTlmT1, warning=FALSE}

library(RColorBrewer)

load(file="/Users/daraneumann/Downloads/Research/NCT/Data/Demographic.Data.RData") #import demographic data
setwd("/Users/daraneumann/Downloads/Research/NCT/Results/")

minimumcontrolenergyt1=readMat("/Users/daraneumann/Downloads/Research/NCT/Results/AprilMinimum.Control.Energy.T1.mat")$minimumcontrolenergy #import minimum CE

dim(minimumcontrolenergyt1) #dimensions are 554 x 36

CE.t.test=NULL
lm.state.TE.estimate=NULL
lm.entry=NULL
lm.state.TE.pvalue=NULL

for(i in 1:36){ #compare for 6x6 clusters
  t.test.entry=t.test(minimumcontrolenergyt1[which(dem.data$Status=="MCI"),i], #t-test assumes MCI > HC
                      minimumcontrolenergyt1[which(dem.data$Status=="HC"),i])
  CE.t.test=rbind(CE.t.test,c(t.test.entry$statistic,t.test.entry$p.value))
  
  lm.entry=summary(lm(minimumcontrolenergyt1[,i]~Status+Sex+Age+ICV,data=dem.data))
  lm.state.TE.estimate=rbind(lm.state.TE.estimate,lm.entry$coefficients[2,1])
  lm.state.TE.pvalue=rbind(lm.state.TE.pvalue,lm.entry$coefficients[2,4])
}

adjusted.lm.state.TE.pvalue=p.adjust(lm.state.TE.pvalue,n=36,method="BH")
lm.state.TE.pvalue
adjusted.lm.state.TE.pvalue


setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create heatmap
png(file="AprilStatewise.Comparison.lm.T1.png",width=800,height=600)

networks=c("DorsAttn (+)","Default (+)","Default (-)",
           "DorsAttn (-)", "Visual (-)","Visual (+)") #change based on previous results

#matrix=matrix((CE.t.test[,1]),6,6) #plot with t-test estimates
matrix=matrix(lm.state.TE.estimate,6,6) #plot with lm estimates
  
ordered.networks=c("DAN (+)","DAN (-)","DMN (+)",
                   "DMN (-)","VIS (+)","VIS (-)")

ordered.matrix=matrix[c(1,4,2,3,6,5),c(1,4,2,3,6,5)] #change based on previous results

plot=levelplot(t(ordered.matrix),
               #col.regions=colorRampPalette(turbo(200)), #color palette and how many sub-colors
               col.regions=colorRampPalette(rev(brewer.pal(11,"RdBu"))),
               colorkey=list(space="left"), #location of color key
               at=seq(-38.1,38.1,length.out=200),
               main="Comparison of State-Wise Transition Energy using lm Estimate (MCI > HC) at T=1",
               xlab="",ylab="",
               scales=list(x=list(at=seq(1,6),labels=ordered.networks,cex=1.5,font=2),
                           y=list(at=seq(1,6),labels=ordered.networks,cex=1.5,font=2)));plot #omit scales argument if networks are not yet known

```

```{r StatePlotANOVA, warning=FALSE}

library(RColorBrewer)

load(file="/Users/daraneumann/Downloads/Research/NCT/Data/Demographic.Data.RData") #import demographic data
setwd("/Users/daraneumann/Downloads/Research/NCT/Results/")

minimumcontrolenergy=readMat("/Users/daraneumann/Downloads/Research/NCT/Results/AprilMinimum.Control.Energy.mat")$minimumcontrolenergy #import minimum CE

dim(minimumcontrolenergy) #dimensions are 554 x 36

CE.anova=NULL

for(i in 1:36){ #compare for 6x6 clusters
  anova.entry=summary(aov((minimumcontrolenergy)[,i]~Status+Sex+Age+ICV+Study,data=dem.data))
  results.anova=as.data.frame(anova.entry[[1]])
  CE.anova=rbind(CE.anova,c(results.anova$'F value'[1],results.anova$'Pr(>F)'[1]))
}

print(CE.anova[1:5,])

significant.p.values=which(p.adjust(CE.anova[,2],n=36,method="BH")<0.05) #find significant p-values

print(significant.p.values)


setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create heatmap
png(file="AprilStatewise.Comparison.ANOVA.png",width=800,height=600)

networks=c("Limbic (-)","SomMotor (-)","SomMotor (+)",
           "Limbic (+)", "Visual (-)","Visual (+)") #change based on previous results

matrix=matrix((CE.anova[,1]),6,6)
  
ordered.networks=c("Limbic (+)","Limbic (-)","SomMotor (+)",
                   "SomMotor (-)","Visual (+)","Visual (-)")

ordered.matrix=matrix[c(4,1,3,2,6,5),c(4,1,3,2,6,5)] #change based on previous results
  
plot=levelplot(t(ordered.matrix),
               col.regions=viridis(200), #color palette and how many sub-colors
               colorkey=list(space="left"), #location of color key
               main="Comparison of State-Wise Transition Energy using ANCOVA (MCI > HC)",
               xlab="",ylab="",
               scales=list(x=list(at=seq(1,6),labels=ordered.networks),
                           y=list(at=seq(1,6),labels=ordered.networks)));plot #omit scales argument if networks are not yet known

```

```{r StatePlotANOVAT1, warning=FALSE}

library(RColorBrewer)

load(file="/Users/daraneumann/Downloads/Research/NCT/Data/Demographic.Data.RData") #import demographic data
setwd("/Users/daraneumann/Downloads/Research/NCT/Results/")

minimumcontrolenergyt1=readMat("/Users/daraneumann/Downloads/Research/NCT/Results/AprilMinimum.Control.Energy.T1.mat")$minimumcontrolenergy #import minimum CE

dim(minimumcontrolenergyt1) #dimensions are 554 x 36

CE.anova=NULL

for(i in 1:36){ #compare for 6x6 clusters
  anova.entry=summary(aov((minimumcontrolenergyt1)[,i]~Status+Sex+Age+ICV+Study,data=dem.data))
  results.anova=as.data.frame(anova.entry[[1]])
  CE.anova=rbind(CE.anova,c(results.anova$'F value'[1],results.anova$'Pr(>F)'[1]))
}

print(CE.anova[1:5,])

significant.p.values=which(p.adjust(CE.anova[,2],n=36,method="BH")<0.05) #find significant p-values

print(significant.p.values)


setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create heatmap
png(file="AprilStatewise.Comparison.ANOVA.T1.png",width=800,height=600)

networks=c("Limbic (-)","SomMotor (-)","SomMotor (+)",
           "Limbic (+)", "Visual (-)","Visual (+)") #change based on previous results

matrix=matrix((CE.anova[,1]),6,6)
  
ordered.networks=c("Limbic (+)","Limbic (-)","SomMotor (+)",
                   "SomMotor (-)","Visual (+)","Visual (-)")

ordered.matrix=matrix[c(4,1,3,2,6,5),c(4,1,3,2,6,5)] #change based on previous results
  
plot=levelplot(t(ordered.matrix),
               col.regions=viridis(200), #color palette and how many sub-colors
               colorkey=list(space="left"), #location of color key
               main="Comparison of State-Wise Transition Energy using ANCOVA (MCI > HC) at T=1",
               xlab="",ylab="",
               scales=list(x=list(at=seq(1,6),labels=ordered.networks),
                           y=list(at=seq(1,6),labels=ordered.networks)));plot #omit scales argument if networks are not yet known

```

```{r StatePlotHC, warning=FALSE}

library(RColorBrewer)

load(file="/Users/daraneumann/Downloads/Research/NCT/Data/Demographic.Data.RData") #import demographic data
setwd("/Users/daraneumann/Downloads/Research/NCT/Results/")

minimumcontrolenergy=readMat("/Users/daraneumann/Downloads/Research/NCT/Results/AprilMinimum.Control.Energy.mat")$minimumcontrolenergy #import minimum CE

dim(minimumcontrolenergy) #dimensions are 554 x 36

average.state.CE.HC=colMeans(minimumcontrolenergy[which(dem.data$Status=="HC"),])

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/")
png(file="AprilStatewise.CE.HC.png",width=800,height=600) #create heatmap for HC

networks=c("DorsAttn (+)","Default (+)","Default (-)",
           "DorsAttn (-)", "Visual (-)","Visual (+)") #change based on previous results

matrix=matrix(average.state.CE.HC,6,6)
  
ordered.networks=c("DAN (+)","DAN (-)","DMN (+)",
                   "DMN (-)","VIS (+)","VIS (-)")

ordered.matrix=matrix[c(1,4,2,3,6,5),c(1,4,2,3,6,5)] #change based on previous results
  
plot=levelplot(t(ordered.matrix),
               col.regions=colorRampPalette(plasma(200)), #color palette and how many sub-colors
               colorkey=list(space="left"), #location of color key
               main="State-Wise Transition Energy for HC",
               xlab="",ylab="",
               scales=list(x=list(at=seq(1,6),labels=ordered.networks,cex=1.5,font=2),
                           y=list(at=seq(1,6),labels=ordered.networks,cex=1.5,font=2)));plot #omit scales argument if networks are not yet known

```

```{r StatePlotHCT1, warning=FALSE}

library(RColorBrewer)

load(file="/Users/daraneumann/Downloads/Research/NCT/Data/Demographic.Data.RData") #import demographic data
setwd("/Users/daraneumann/Downloads/Research/NCT/Results/")

minimumcontrolenergyt1=readMat("/Users/daraneumann/Downloads/Research/NCT/Results/AprilMinimum.Control.Energy.T1.mat")$minimumcontrolenergy #import minimum CE

dim(minimumcontrolenergyt1) #dimensions are 554 x 36

average.state.CE.HC=colMeans(minimumcontrolenergyt1[which(dem.data$Status=="HC"),])

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/")
png(file="AprilStatewise.CE.HC.T1.png",width=800,height=600) #create heatmap for HC

networks=c("DorsAttn (+)","Default (+)","Default (-)",
           "DorsAttn (-)", "Visual (-)","Visual (+)") #change based on previous results

matrix=matrix(average.state.CE.HC,6,6)
  
ordered.networks=c("DAN (+)","DAN (-)","DMN (+)",
                   "DMN (-)","VIS (+)","VIS (-)")

ordered.matrix=matrix[c(1,4,2,3,6,5),c(1,4,2,3,6,5)] #change based on previous results
  
plot=levelplot(t(ordered.matrix),
               col.regions=plasma(200), #color palette and how many sub-colors
               colorkey=list(space="left"), #location of color key
               main="State-Wise Transition Energy for HC at T=1",
               xlab="",ylab="",
               scales=list(x=list(at=seq(1,6),labels=ordered.networks,cex=1.5,font=2),
                           y=list(at=seq(1,6),labels=ordered.networks,cex=1.5,font=2)));plot #omit scales argument if networks are not yet known

```

```{r StatePlotMCI, warning=FALSE}

library(RColorBrewer)

load(file="/Users/daraneumann/Downloads/Research/NCT/Data/Demographic.Data.RData") #import demographic data
setwd("/Users/daraneumann/Downloads/Research/NCT/Results/")

minimumcontrolenergy=readMat("/Users/daraneumann/Downloads/Research/NCT/Results/AprilMinimum.Control.Energy.mat")$minimumcontrolenergy #import minimum CE

dim(minimumcontrolenergy) #dimensions are 554 x 36

average.state.CE.MCI=colMeans(minimumcontrolenergy[which(dem.data$Status=="MCI"),])

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/")
png(file="AprilStatewise.CE.MCI.png",width=800,height=600) #create heatmap for MCI

networks=c("DorsAttn (+)","Default (+)","Default (-)",
           "DorsAttn (-)", "Visual (-)","Visual (+)") #change based on previous results

matrix=matrix(average.state.CE.MCI,6,6)
  
ordered.networks=c("DAN (+)","DAN (-)","DMN (+)",
                   "DMN (-)","VIS (+)","VIS (-)")

ordered.matrix=matrix[c(1,4,2,3,6,5),c(1,4,2,3,6,5)] #change based on previous results
  
plot=levelplot(t(ordered.matrix),
               col.regions=plasma(200), #color palette and how many sub-colors
               main="State-Wise Transition Energy for MCI",
               xlab="",ylab="",
               scales=list(x=list(at=seq(1,6),labels=ordered.networks,cex=1.5,font=2),
                           y=list(at=seq(1,6),labels=ordered.networks,cex=1.5,font=2)));plot #omit scales argument if networks are not yet known

```

```{r StatePlotMCIT1, warning=FALSE}

library(RColorBrewer)

load(file="/Users/daraneumann/Downloads/Research/NCT/Data/Demographic.Data.RData") #import demographic data
setwd("/Users/daraneumann/Downloads/Research/NCT/Results/")

minimumcontrolenergyt1=readMat("/Users/daraneumann/Downloads/Research/NCT/Results/AprilMinimum.Control.Energy.T1.mat")$minimumcontrolenergy #import minimum CE

dim(minimumcontrolenergyt1) #dimensions are 554 x 36

average.state.CE.MCI=colMeans(minimumcontrolenergyt1[which(dem.data$Status=="MCI"),])

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/")
png(file="AprilStatewise.CE.MCI.T1.png",width=800,height=600) #create heatmap for MCI

networks=c("DorsAttn (+)","Default (+)","Default (-)",
           "DorsAttn (-)", "Visual (-)","Visual (+)") #change based on previous results

matrix=matrix(average.state.CE.MCI,6,6)
  
ordered.networks=c("DAN (+)","DAN (-)","DMN (+)",
                   "DMN (-)","VIS (+)","VIS (-)")

ordered.matrix=matrix[c(1,4,2,3,6,5),c(1,4,2,3,6,5)] #change based on previous results
  
plot=levelplot(t(ordered.matrix),
               col.regions=plasma(200), #color palette and how many sub-colors
               main="State-Wise Transition Energy for MCI at T=1",
               xlab="",ylab="",
               scales=list(x=list(at=seq(1,6),labels=ordered.networks,cex=1.5,font=2),
                           y=list(at=seq(1,6),labels=ordered.networks,cex=1.5,font=2)));plot #omit scales argument if networks are not yet known

```

```{r OldStatePlotAge, warning=FALSE}

load(file="/Users/daraneumann/Downloads/Research/NCT/Data/Demographic.Data.RData") #import demographic data
setwd("/Users/daraneumann/Downloads/Research/NCT/Results/")

minimumcontrolenergy=readMat("/Users/daraneumann/Downloads/Research/NCT/Results/Minimum.Control.Energy.mat")$minimumcontrolenergy #import minimum CE

dim(minimumcontrolenergy) #dimensions are 557 x 36

CE.age.cor=NULL

for(i in 1:36){ #pairwise comparison between six clusters/states
  cor.entry=cor.test(minimumcontrolenergy[,i],data$Age,method="pearson")
  
  CE.age.cor=rbind(CE.age.cor,c(cor.entry$statistic,cor.entry$p.value))
}

print(CE.age.cor[1:5,])

p.adjust(CE.age.cor[,2],n=36,method="BH") #adjust p-values
print(paste("Number of Significant p-values: ",
            length(which(p.adjust(CE.age.cor[,2],n=36,method="BH")<0.05)))) #find significant p-values


setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create heatmap
pdf(file="Correlation.Age.pdf",width=9,height=8)
  
at1=seq(-4.18,4.18,length.out=200)
rwb=colorRampPalette(colors=c("blue","purple","yellow"))
col1=rwb(200)

networks=c("Limbic (-)","SomMotor (-)","Visual (-)",
           "Visual (+)","SomMotor (+)","Limbic (+)") #change based on previous results
matrix=matrix((CE.age.cor[,1]),6,6)

ordered.networks=c("Limbic (+)","Limbic (-)","SomMotor (+)",
                   "SomMotor (-)","Visual (+)","Visual (-)")
ordered.matrix=matrix[c(6,1,5,2,4,3),c(6,1,5,2,4,3)] #change based on previous results
  
plot=levelplot(ordered.matrix,col.regions=col1,main="Transition Energy vs. Age Correlation",xlab="",ylab="",scales=list(x=list(at=seq(1,6),labels=ordered.networks),y=list(at=seq(1,6),labels=ordered.networks)));plot #omit scales argument if networks are not yet known

```

```{r OldStatePlotSex, warning=FALSE}

load(file="/Users/daraneumann/Downloads/Research/NCT/Data/Demographic.Data.RData") #import demographic data
setwd("/Users/daraneumann/Downloads/Research/NCT/Results/")

minimumcontrolenergy=readMat("/Users/daraneumann/Downloads/Research/NCT/Results/Minimum.Control.Energy.mat")$minimumcontrolenergy #import minimum CE

dim(minimumcontrolenergy) #dimensions are 557 x 36

CE.t.test.sex=NULL

for(i in 1:36){ #compare for 6x6 clusters
  t.test.entry=t.test(minimumcontrolenergy[which(data$Sex==1),i], #females coded as 1, males coded as 0
                      minimumcontrolenergy[which(data$Sex==0),i]) #t-test assumes females > males
  
  CE.t.test.sex=rbind(CE.t.test.sex,c(t.test.entry$statistic,t.test.entry$p.value))
}

print(CE.t.test.sex[1:5,])

p.adjust(CE.t.test.sex[,2],n=36,method="BH") #adjust p-values
print(paste("Number of Significant p-values: ",
            length(which(p.adjust(CE.t.test.sex[,2],n=36,method="BH")<0.05)))) #find significant p-values


setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create heatmap
pdf(file="Comparison.Sex.pdf",width=9,height=8)
  
at1=seq(-4.18,4.18,length.out=200)
rwb=colorRampPalette(colors=c("blue","purple","yellow"))
col1=rwb(200)
  
networks=c("Limbic (-)","SomMotor (-)","Visual (-)",
           "Visual (+)","SomMotor (+)","Limbic (+)") #change based on previous results
matrix=matrix((CE.t.test.sex[,1]),6,6)
  
ordered.networks=c("Limbic (+)","Limbic (-)","SomMotor (+)",
                   "SomMotor (-)","Visual (+)","Visual (-)")
ordered.matrix=matrix[c(6,1,5,2,4,3),c(6,1,5,2,4,3)] #change based on previous results
  
plot=levelplot(ordered.matrix,col.regions=col1,main="Females > Males",xlab="",ylab="",scales=list(x=list(at=seq(1,6),labels=ordered.networks),y=list(at=seq(1,6),labels=ordered.networks)));plot #omit scales argument if networks are not yet known

```

------------------------------------------------------------------------

## Regional

```{r RegionalCE, warning=FALSE}

regional.TE=readMat('/Users/daraneumann/Downloads/Research/NCT/Results/AprilRegional.Minimum.CE.mat')$regionalTE[,1,]

regional.CE.status=NULL
regional.CE.sex=NULL
regional.CE.age=NULL
regional.CE.icv=NULL

lm.estimates=NULL
lm.pvalue=NULL
t.estimates=NULL

dem.data$Status=as.factor(dem.data$Status)
dem.data$Sex=as.factor(dem.data$Sex)

dem.data$Status=relevel(dem.data$Status,ref="HC") #estimate > 0 indicates TE higher for MCI (MCI - HC)
dem.data$Sex=relevel(dem.data$Sex,ref="1") #females are coded as 1; estimate > 0 indicates higher TE for males (males - females)

for(i in 1:200) { #use ANOVA to test whether there is a difference, and use lm for directionality
  anova.entry=summary(aov(regional.TE[,i]~Status+Sex+Age+ICV,data=dem.data))
  results.anova=as.data.frame(anova.entry[[1]])
  
  regional.CE.status=rbind(regional.CE.status,c(results.anova$'F value'[1],results.anova$'Pr(>F)'[1]))
  regional.CE.sex=rbind(regional.CE.sex,c(results.anova$'F value'[2],results.anova$'Pr(>F)'[2]))
  regional.CE.age=rbind(regional.CE.age,c(results.anova$'F value'[3],results.anova$'Pr(>F)'[3]))
  regional.CE.icv=rbind(regional.CE.icv,c(results.anova$'F value'[4],results.anova$'Pr(>F)'[4]))
  
  t.entry=t.test(regional.TE[which(dem.data$Status=="MCI"),i], #t-test assumes MCI > HC
                 regional.TE[which(dem.data$Status=="HC"),i])
  t.estimates=rbind(t.estimates,t.entry$statistic)
  
  lm.entry=summary(lm(regional.TE[,i]~Status+Sex+Age+ICV,data=dem.data))
  lm.estimates=rbind(lm.estimates,lm.entry$coefficients[2:3,1]) #isolate coefficients
  lm.pvalue=rbind(lm.pvalue,lm.entry$coefficients[2,4]) #isolate p-value for status
  
}

#make MATLAB files to make the brain plots
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/Aprilt.Estimates.mat",labpcexport=t.estimates[,1])

lm.estimates.status=lm.estimates[,1]
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/AprilCE.Estimates.Status.mat",labpcexport=lm.estimates.status)

lm.estimates.sex=lm.estimates[,2]
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/AprilCE.Estimates.Sex.mat",labpcexport=lm.estimates.sex)



#identify regions that are significantly different
significant.regions=which(p.adjust(lm.pvalue,n=200,method="BH")<0.05)
print(paste("Number of Regions with Significantly Different TE between MCI and HC: ",
            length(significant.regions)))

#find regions where TE_MCI > TE_HC, then display them in order of magnitude
mci.greater=significant.regions[which(lm.estimates[significant.regions]>0)]
print(paste("Number of Regions where TE_MCI is Significantly Greater than TE_HC:",
      length(mci.greater)))
print(paste("Regions (decreasing strength): ",toString(mci.greater[order(lm.estimates[mci.greater],decreasing=TRUE)])))

#find regions where TE_HC > TE_MCI, then display them in order of magnitude
hc.greater=significant.regions[which(lm.estimates[significant.regions]<0)]
print(paste("Number of Regions where TE_HC is Significantly Greater than TE_MCI:",
      length(hc.greater)))
print(paste("Regions (decreasing strength): ",toString(hc.greater[order(lm.estimates[hc.greater],decreasing=FALSE)])))

```

```{r RegionalCET1, warning=FALSE}

regional.TE.T1=readMat('/Users/daraneumann/Downloads/Research/NCT/Results/AprilRegional.Minimum.CE.T1.mat')$regionalTE[,1,]

regional.CE.status=NULL
regional.CE.sex=NULL
regional.CE.age=NULL
regional.CE.icv=NULL

lm.estimates=NULL
lm.pvalue=NULL
t.estimates=NULL

dem.data$Status=as.factor(dem.data$Status)
dem.data$Sex=as.factor(dem.data$Sex)

dem.data$Status=relevel(dem.data$Status,ref="HC") #estimate > 0 indicates TE higher for MCI (MCI - HC)
dem.data$Sex=relevel(dem.data$Sex,ref="1") #females are coded as 1; estimate > 0 indicates higher TE for males (males - females)

for(i in 1:200) { #use ANOVA to test whether there is a difference, and use lm for directionality
  anova.entry=summary(aov(regional.TE.T1[,i]~Status+Sex+Age+ICV,data=dem.data))
  results.anova=as.data.frame(anova.entry[[1]])
  
  regional.CE.status=rbind(regional.CE.status,c(results.anova$'F value'[1],results.anova$'Pr(>F)'[1]))
  regional.CE.sex=rbind(regional.CE.sex,c(results.anova$'F value'[2],results.anova$'Pr(>F)'[2]))
  regional.CE.age=rbind(regional.CE.age,c(results.anova$'F value'[3],results.anova$'Pr(>F)'[3]))
  regional.CE.icv=rbind(regional.CE.icv,c(results.anova$'F value'[4],results.anova$'Pr(>F)'[4]))
  
  lm.entry=summary(lm(regional.TE.T1[,i]~Status+Sex+Age+ICV,data=dem.data))
  lm.estimates=rbind(lm.estimates,lm.entry$coefficients[2:3,1]) #isolate coefficients for status and sex
  lm.pvalue=rbind(lm.pvalue,lm.entry$coefficients[2,4]) #isolate p-value for status
  
  t.entry=t.test(regional.TE.T1[which(dem.data$Status=="MCI"),i], #t-test assumes MCI > HC
                 regional.TE.T1[which(dem.data$Status=="HC"),i])
  t.estimates=rbind(t.estimates,t.entry$statistic)
}

#make MATLAB files to make the brain plots
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/Aprilt.Estimates.T1.mat",labpcexport=t.estimates[,1])

lm.estimates.status=lm.estimates[,1]
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/AprilCE.Estimates.Status.T1.mat",labpcexport=lm.estimates.status)

lm.estimates.sex=lm.estimates[,2]
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/AprilCE.Estimates.Sex.T1.mat",labpcexport=lm.estimates.sex)



#identify regions that are significantly different
significant.regions=which(p.adjust(lm.pvalue,n=200,method="BH")<0.05)
print(paste("Number of Regions with Significantly Different TE between MCI and HC at T=1: ",
            length(significant.regions)))

#find regions where TE_MCI > TE_HC, then display them in order of magnitude
mci.greater=significant.regions[which(lm.estimates[significant.regions]>0)]
print(paste("Number of Regions where TE_MCI is Significantly Greater than TE_HC at T=1:",
      length(mci.greater)))
print(paste("Regions (decreasing strength): ",toString(mci.greater[order(lm.estimates[mci.greater],decreasing=TRUE)])))

#find regions where TE_HC > TE_MCI, then display them in order of magnitude
hc.greater=significant.regions[which(lm.estimates[significant.regions]<0)]
print(paste("Number of Regions where TE_HC is Significantly Greater than TE_MCI at T=1:",
      length(hc.greater)))
print(paste("Regions (decreasing strength): ",toString(hc.greater[order(lm.estimates[hc.greater],decreasing=FALSE)])))

```

```{r RegionalPlaque, warning=FALSE}

regional.plaque.status=NULL
regional.plaque.sex=NULL
regional.plaque.age=NULL
regional.plaque.icv=NULL

lm.estimates=NULL
t.estimates=NULL

dem.data$Status=as.factor(dem.data$Status)
dem.data$Sex=as.factor(dem.data$Sex)

dem.data$Status=relevel(dem.data$Status,ref="HC") #estimate > 0 indicates plaque higher for MCI (MCI - HC)
dem.data$Sex=relevel(dem.data$Sex,ref="1") #females are coded as 1; estimate > 0 indicates higher plaque for males (males - females)

for(i in 2:201) { #use ANOVA to test whether there is a difference, and use lm for directionality
  anova.entry=summary(aov(plaque[,i]~Status+Sex+Age+ICV,data=dem.data))
  results.anova=as.data.frame(anova.entry[[1]])
  
  regional.plaque.status=rbind(regional.plaque.status,c(results.anova$'F value'[1],results.anova$'Pr(>F)'[1]))
  regional.plaque.sex=rbind(regional.plaque.sex,c(results.anova$'F value'[2],results.anova$'Pr(>F)'[2]))
  regional.plaque.age=rbind(regional.plaque.age,c(results.anova$'F value'[3],results.anova$'Pr(>F)'[3]))
  regional.plaque.icv=rbind(regional.plaque.icv,c(results.anova$'F value'[4],results.anova$'Pr(>F)'[4]))
  
  lm.entry=summary(lm(plaque[,i]~Status+Sex+Age+ICV,data=dem.data))
  lm.estimates=rbind(lm.estimates,lm.entry$coefficients[2:3,1]) #isolate coefficients for status and sex
  
  t.entry=t.test(plaque[which(dem.data$Status=="MCI"),i], #t-test assumes MCI > HC
                 plaque[which(dem.data$Status=="HC"),i])
  t.estimates=rbind(t.estimates,t.entry$statistic)
}

writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/t.Estimates.Plaque.mat",labpcexport=t.estimates[,1])

lm.estimates.status=lm.estimates[,1]
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/Plaque.Estimates.Status.mat",labpcexport=lm.estimates.status)

#identify regions that are significantly different
significant.regions=which(p.adjust(regional.plaque.status[,2],n=200,method="BH")<0.05)
print(paste("Number of Regions with Significantly Different Plaque between MCI and HC: ",
            length(significant.regions)))

#find regions where plaque_MCI > plaque_HC, then display them in order of magnitude
mci.greater=significant.regions[which(t.estimates[significant.regions,]>0)]
print(paste("Number of Regions where plaque_MCI is Significantly Greater than plaque_HC:",
      length(mci.greater)))
print(paste("Regions (decreasing strength): ",toString(mci.greater[order(t.estimates[mci.greater,],decreasing=TRUE)])))

#find regions where plaque_HC > plaque_MCI, then display them in order of magnitude
hc.greater=significant.regions[which(t.estimates[significant.regions,]<0)]
print(paste("Number of Regions where plaque_HC is Significantly Greater than plaque_MCI:",
      length(hc.greater)))
print(paste("Regions (decreasing strength): ",toString(hc.greater[order(t.estimates[hc.greater,],decreasing=FALSE)])))

```

```{r RegionalTau, warning=FALSE}

regional.tau.status=NULL
regional.tau.sex=NULL
regional.tau.age=NULL
regional.tau.icv=NULL

lm.estimates=NULL
t.estimates=NULL

dem.data$Status=as.factor(dem.data$Status)
dem.data$Sex=as.factor(dem.data$Sex)

dem.data$Status=relevel(dem.data$Status,ref="HC") #estimate > 0 indicates tau higher for MCI (MCI - HC)
dem.data$Sex=relevel(dem.data$Sex,ref="1") #females are coded as 1; estimate > 0 indicates higher tau for males (males - females)

for(i in 2:201) { #use ANOVA to test whether there is a difference, and use lm for directionality
  anova.entry=summary(aov(tau[,i]~Status+Sex+Age+ICV,data=dem.data))
  results.anova=as.data.frame(anova.entry[[1]])
  
  regional.tau.status=rbind(regional.tau.status,c(results.anova$'F value'[1],results.anova$'Pr(>F)'[1]))
  regional.tau.sex=rbind(regional.tau.sex,c(results.anova$'F value'[2],results.anova$'Pr(>F)'[2]))
  regional.tau.age=rbind(regional.tau.age,c(results.anova$'F value'[3],results.anova$'Pr(>F)'[3]))
  regional.tau.icv=rbind(regional.tau.icv,c(results.anova$'F value'[4],results.anova$'Pr(>F)'[4]))
  
  lm.entry=summary(lm(tau[,i]~Status+Sex+Age+ICV,data=dem.data))
  lm.estimates=rbind(lm.estimates,lm.entry$coefficients[2:3,1]) #isolate coefficients for status and sex
  
  t.entry=t.test(tau[which(dem.data$Status=="MCI"),i], #t-test assumes MCI > HC
                 tau[which(dem.data$Status=="HC"),i])
  t.estimates=rbind(t.estimates,t.entry$statistic)
}

writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/t.Estimates.Tau.mat",labpcexport=t.estimates[,1])

lm.estimates.status=lm.estimates[,1]
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/Tau.Estimates.Status.mat",labpcexport=lm.estimates.status)


#identify regions that are significantly different
significant.regions=which(p.adjust(regional.tau.status[,2],n=200,method="BH")<0.05)
print(paste("Number of Regions with Significantly Different Tau between MCI and HC: ",
            length(significant.regions)))

#find regions where tau_MCI > tau_HC, then display them in order of magnitude
mci.greater=significant.regions[which(t.estimates[significant.regions,]>0)]
print(paste("Number of Regions where tau_MCI is Significantly Greater than tau_HC:",
      length(mci.greater)))
print(paste("Regions (decreasing strength): ",toString(mci.greater[order(t.estimates[mci.greater,],decreasing=TRUE)])))

#find regions where tau_HC > tau_MCI, then display them in order of magnitude
hc.greater=significant.regions[which(t.estimates[significant.regions,]<0)]
print(paste("Number of Regions where tau_HC is Significantly Greater than tau_MCI:",
      length(hc.greater)))
print(paste("Regions (decreasing strength): ",toString(hc.greater[order(t.estimates[hc.greater,],decreasing=FALSE)])))

```

```{r RegionalAssociation, warning=FALSE}

regional.TE=readMat('/Users/daraneumann/Downloads/Research/NCT/Results/AprilRegional.Minimum.CE.mat')$regionalTE[,1,]
load(file="/Users/daraneumann/Downloads/Research/NCT/Results/Entropy.RData") #import entropy data
load(file="/Users/daraneumann/Downloads/Research/NCT/Data/Demographic.Data.RData") #import demographic data

lm.estimates.TE.plaque=NULL
lm.entry.TE.plaque=NULL
lm.results.TE.plaque=NULL
cor.results.TE.plaque=NULL
cor.entry.TE.plaque=NULL
cor.estimates.TE.plaque=NULL

lm.estimates.TE.tau=NULL
lm.entry.TE.tau=NULL
lm.results.TE.tau=NULL
cor.results.TE.tau=NULL
cor.entry.TE.tau=NULL
cor.estimates.TE.tau=NULL

lm.estimates.entropy.plaque=NULL
lm.entry.entropy.plaque=NULL
lm.results.entropy.plaque=NULL
cor.results.entropy.plaque=NULL
cor.entry.entropy.plaque=NULL
cor.estimates.entropy.plaque=NULL

lm.estimates.entropy.tau=NULL
lm.entry.entropy.tau=NULL
lm.results.entropy.tau=NULL
cor.results.entropy.tau=NULL
cor.entry.entropy.tau=NULL
cor.estimates.entropy.tau=NULL

regional.TE.MCI=regional.TE[which(dem.data$Status=="MCI"),]
entropy.MCI=entropy[which(dem.data$Status=="MCI"),]
plaque.MCI=plaque[which(dem.data$Status=="MCI"),]
tau.MCI=tau[which(dem.data$Status=="MCI"),]
sex.MCI=dem.data[which(dem.data$Status=="MCI"),]$Sex
age.MCI=dem.data[which(dem.data$Status=="MCI"),]$Age
icv.MCI=dem.data[which(dem.data$Status=="MCI"),]$ICV


dem.data$Status=as.factor(dem.data$Status)
dem.data$Sex=as.factor(dem.data$Sex)

dem.data$Status=relevel(dem.data$Status,ref="HC") #estimate > 0 indicates plaque higher for MCI (MCI - HC)
dem.data$Sex=relevel(dem.data$Sex,ref="1") #females are coded as 1; estimate > 0 indicates higher plaque for males (males - females)

lm.entry.TE.entropy=NULL
lm.results.TE.entropy=NULL
cor.entry.TE.entropy=NULL
cor.results.TE.entropy=NULL

for(i in 1:200) { #use lm
  lm.entry.TE.entropy=summary(lm(regional.TE[,i]~entropy[,i]+
                                  dem.data$Sex+dem.data$Age+dem.data$ICV))
  lm.results.TE.entropy=rbind(lm.results.TE.entropy,lm.entry.TE.entropy$coefficients[2,1:4]) #isolate coefficients
  cor.entry.TE.entropy=cor.test(as.numeric(regional.TE[,i]),as.numeric(entropy[,i]),method="spearman")
  cor.results.TE.entropy=rbind(cor.results.TE.entropy,data.frame(cor.entry.TE.entropy$estimate,cor.entry.TE.entropy$p.value))
}

for(i in 1:200) { #use lm
  lm.entry.TE.plaque=summary(lm(plaque.MCI[,i+1]~regional.TE.MCI[,i]+
                                  dem.data[which(dem.data$Status=="MCI"),]$Sex+
                                  dem.data[which(dem.data$Status=="MCI"),]$Age+
                                  dem.data[which(dem.data$Status=="MCI"),]$ICV))
  lm.results.TE.plaque=rbind(lm.results.TE.plaque,lm.entry.TE.plaque$coefficients[2,1:4]) #isolate coefficients
  cor.entry.TE.plaque=cor.test(as.numeric(plaque.MCI[,i+1]),as.numeric(regional.TE.MCI[,i]),method="spearman")
  cor.results.TE.plaque=rbind(cor.results.TE.plaque,data.frame(cor.entry.TE.plaque$estimate,cor.entry.TE.plaque$p.value))
  
  
  lm.entry.TE.tau=summary(lm(tau.MCI[,i+1]~regional.TE.MCI[,i]+
                                  dem.data[which(dem.data$Status=="MCI"),]$Sex+
                                  dem.data[which(dem.data$Status=="MCI"),]$Age+
                                  dem.data[which(dem.data$Status=="MCI"),]$ICV))
  lm.results.TE.tau=rbind(lm.results.TE.tau,lm.entry.TE.tau$coefficients[2,1:4])
  cor.entry.TE.tau=cor.test(as.numeric(tau.MCI[,i+1]),as.numeric(regional.TE.MCI[,i]),method="spearman")
  cor.results.TE.tau=rbind(cor.results.TE.tau,data.frame(cor.entry.TE.tau$estimate,cor.entry.TE.tau$p.value))
  
  
  lm.entry.entropy.plaque=summary(lm(plaque.MCI[,i+1]~entropy.MCI[,i]+
                                  dem.data[which(dem.data$Status=="MCI"),]$Sex+
                                  dem.data[which(dem.data$Status=="MCI"),]$Age+
                                  dem.data[which(dem.data$Status=="MCI"),]$ICV))
  lm.results.entropy.plaque=rbind(lm.results.entropy.plaque,lm.entry.entropy.plaque$coefficients[2,1:4])
  cor.entry.entropy.plaque=cor.test(as.numeric(plaque.MCI[,i+1]),as.numeric(entropy.MCI[,i]),method="spearman")
  cor.results.entropy.plaque=rbind(cor.results.entropy.plaque,data.frame(cor.entry.entropy.plaque$estimate,cor.entry.entropy.plaque$p.value))
  
  
  lm.entry.entropy.tau=summary(lm(tau.MCI[,i+1]~entropy.MCI[,i]+
                                  dem.data[which(dem.data$Status=="MCI"),]$Sex+
                                  dem.data[which(dem.data$Status=="MCI"),]$Age+
                                  dem.data[which(dem.data$Status=="MCI"),]$ICV))
  lm.results.entropy.tau=rbind(lm.results.entropy.tau,lm.entry.entropy.tau$coefficients[2,1:4])
  cor.entry.entropy.tau=cor.test(as.numeric(tau.MCI[,i+1]),as.numeric(entropy.MCI[,i]),method="spearman")
  cor.results.entropy.tau=rbind(cor.results.entropy.tau,data.frame(cor.entry.entropy.tau$estimate,cor.entry.entropy.tau$p.value))

}

cor.estimates.TE.entropy=cor.results.TE.entropy[,1]
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/AprilTE.Entropy.Cor.Estimates.mat",labpcexport=cor.estimates.TE.entropy)
lm.estimates.TE.entropy=lm.results.TE.entropy[,1]
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/AprilTE.Entropy.Estimates.mat",labpcexport=lm.estimates.TE.entropy)


cor.estimates.TE.plaque=cor.results.TE.plaque[,1]
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/AprilTE.Plaque.Cor.Estimates.mat",labpcexport=cor.estimates.TE.plaque)
lm.estimates.TE.plaque=lm.results.TE.plaque[,1]
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/AprilTE.Plaque.Estimates.mat",labpcexport=lm.estimates.TE.plaque)


cor.estimates.TE.plaque=cor.results.TE.plaque[,1]
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/AprilTE.Plaque.Cor.Estimates.mat",labpcexport=cor.estimates.TE.plaque)
lm.estimates.TE.plaque=lm.results.TE.plaque[,1]
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/AprilTE.Plaque.Estimates.mat",labpcexport=lm.estimates.TE.plaque)


cor.estimates.TE.tau=cor.results.TE.tau[,1]
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/AprilTE.Tau.Cor.Estimates.mat",labpcexport=cor.estimates.TE.tau)
lm.estimates.TE.tau=lm.results.TE.tau[,1]
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/AprilTE.Tau.Estimates.mat",labpcexport=lm.estimates.TE.tau)


cor.estimates.entropy.plaque=cor.results.entropy.plaque[,1]
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/Entropy.Plaque.Cor.Estimates.mat",labpcexport=cor.estimates.entropy.plaque)
lm.estimates.entropy.plaque=lm.results.entropy.plaque[,1]
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/Entropy.Plaque.Estimates.mat",labpcexport=lm.estimates.entropy.plaque)


cor.estimates.entropy.tau=cor.results.entropy.tau[,1]
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/Entropy.Tau.Cor.Estimates.mat",labpcexport=cor.estimates.entropy.tau)
lm.estimates.entropy.tau=lm.results.entropy.tau[,1]
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/Entropy.Tau.Estimates.mat",labpcexport=lm.estimates.entropy.tau)


print(paste("Number of Regions with Significant Association between TE and Entropy:",length(which(p.adjust(lm.results.TE.entropy[,4],n=200,method="BH")<0.05))))
print(paste("Regions with Significant Association between TE and Entropy:",toString(which(p.adjust(lm.results.TE.entropy[,4],n=200,method="BH")<0.05))))
print(paste("Number of Regions with Significant Correlation between TE and Entropy:",length(which(p.adjust(cor.results.TE.entropy[,2],n=200,method="BH")<0.05))))
print(paste("Regions with Significant Correlation between TE and Entropy:",toString(which(p.adjust(cor.results.TE.entropy[,2],n=200,method="BH")<0.05))))


print(paste("Number of Regions with Significant Association between TE and Plaque:",length(which(p.adjust(lm.results.TE.plaque[,4],n=200,method="BH")<0.05))))
print(paste("Regions with Significant Association between TE and Plaque:",toString(which(p.adjust(lm.results.TE.plaque[,4],n=200,method="BH")<0.05))))
print(paste("Number of Regions with Significant Correlation between TE and Plaque:",length(which(p.adjust(cor.results.TE.plaque[,2],n=200,method="BH")<0.05))))
print(paste("Regions with Significant Correlation between TE and Plaque:",toString(which(p.adjust(cor.results.TE.plaque[,2],n=200,method="BH")<0.05))))


print(paste("Number of Regions with Significant Association between TE and Tau:",length(which(p.adjust(lm.results.TE.tau[,4],n=200,method="BH")<0.05))))
print(paste("Regions with Significant Association between TE and Tau:",toString(which(p.adjust(lm.results.TE.tau[,4],n=200,method="BH")<0.05))))
print(paste("Number of Regions with Significant Correlation between TE and Tau:",length(which(p.adjust(cor.results.TE.tau[,2],n=200,method="BH")<0.05))))
print(paste("Regions with Significant Correlation between TE and Tau:",toString(which(p.adjust(cor.results.TE.tau[,2],n=200,method="BH")<0.05))))


print(paste("Number of Regions with Significant Association between Entropy and Plaque:",length(which(p.adjust(lm.results.entropy.plaque[,4],n=200,method="BH")<0.05))))
print(paste("Regions with Significant Association between Entropy and Plaque:",toString(which(p.adjust(lm.results.entropy.plaque[,4],n=200,method="BH")<0.05))))
print(paste("Number of Regions with Significant Correlation between Entropy and Plaque:",length(which(p.adjust(cor.results.entropy.plaque[,2],n=200,method="BH")<0.05))))
print(paste("Regions with Significant Correlation between Entropy and Plaque:",toString(which(p.adjust(cor.results.entropy.plaque[,2],n=200,method="BH")<0.05))))


print(paste("Number of Regions with Significant Association between Entropy and Tau:",length(which(p.adjust(lm.results.entropy.tau[,4],n=200,method="BH")<0.05))))
print(paste("Regions with Significant Association between Entropy and Tau:",toString(which(p.adjust(lm.results.entropy.tau[,4],n=200,method="BH")<0.05))))
print(paste("Number of Regions with Significant Correlation between Entropy and Tau:",length(which(p.adjust(cor.results.entropy.tau[,2],n=200,method="BH")<0.05))))
print(paste("Regions with Significant Correlation between Entropy and Tau:",toString(which(p.adjust(cor.results.entropy.tau[,2],n=200,method="BH")<0.05))))

```

```{r OldRegionalEntropy, warning=FALSE}

load(file="/Users/daraneumann/Downloads/Research/NCT/Data/Demographic.Data.RData") #import demographic data
load(file="/Users/daraneumann/Downloads/Research/NCT/Results/Entropy.RData") #import entropy data
setwd("/Users/daraneumann/Downloads/Research/NCT/Results/")

dim(entropy) #dimensions are 554 x 200

entropy.t.test.MCI.HC=NULL
entropy.lm.estimate=NULL

for(i in 1:200){ #entropy across 200 brain regions
  t.test.entry=t.test(entropy[which(dem.data$Status=="MCI"),i],entropy[which(dem.data$Status=="HC"),i])
  entropy.t.test.MCI.HC=rbind(entropy.t.test.MCI.HC,c(t.test.entry$statistic,t.test.entry$p.value))
  
  lm.entry=summary(lm(entropy[,i]~Status+Sex+Age+ICV,data=dem.data))
  lm.estimates=rbind(lm.estimates,lm.entry$coefficients[2:3,1]) #isolate coefficients for status
}

lm.pvalue=lm.estimates[,2]

print(entropy.t.test.MCI.HC[1:5,])

entropyT=entropy.t.test.MCI.HC[,1] #isolate t-statistic values

writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/Entropy.T.mat",labpcexport=entropyT)

```

```{r RegionalEntropy, warning=FALSE}

load(file="/Users/daraneumann/Downloads/Research/NCT/Data/Demographic.Data.RData") #import demographic data
load(file="/Users/daraneumann/Downloads/Research/NCT/Results/Entropy.RData") #import entropy data
setwd("/Users/daraneumann/Downloads/Research/NCT/Results/")

dim(entropy) #dimensions are 554 x 200


regional.entropy.status=NULL
regional.entropy.sex=NULL
regional.entropy.age=NULL
regional.entropy.icv=NULL

lm.estimates=NULL
t.estimates=NULL

dem.data$Status=as.factor(dem.data$Status)
dem.data$Sex=as.factor(dem.data$Sex)

dem.data$Status=relevel(dem.data$Status,ref="HC") #estimate > 0 indicates tau higher for MCI (MCI - HC)
dem.data$Sex=relevel(dem.data$Sex,ref="1") #females are coded as 1; estimate > 0 indicates higher tau for males (males - females)

for(i in 1:200) { #use ANOVA to test whether there is a difference, and use lm for directionality
  anova.entry=summary(aov(entropy[,i]~Status+Sex+Age+ICV,data=dem.data))
  results.anova=as.data.frame(anova.entry[[1]])
  
  regional.entropy.status=rbind(regional.entropy.status,c(results.anova$'F value'[1],results.anova$'Pr(>F)'[1]))
  regional.entropy.sex=rbind(regional.entropy.sex,c(results.anova$'F value'[2],results.anova$'Pr(>F)'[2]))
  regional.entropy.age=rbind(regional.entropy.age,c(results.anova$'F value'[3],results.anova$'Pr(>F)'[3]))
  regional.entropy.icv=rbind(regional.entropy.icv,c(results.anova$'F value'[4],results.anova$'Pr(>F)'[4]))
  
  lm.entry=summary(lm(entropy[,i]~Status+Sex+Age+ICV,data=dem.data))
  lm.estimates=rbind(lm.estimates,lm.entry$coefficients[2:3,1]) #isolate coefficients for status and sex
  
  t.entry=t.test(entropy[which(dem.data$Status=="MCI"),i], #t-test assumes MCI > HC
                 entropy[which(dem.data$Status=="HC"),i])
  t.estimates=rbind(t.estimates,t.entry$statistic)
}

writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/t.Estimates.Entropy.mat",labpcexport=t.estimates[,1])

lm.estimates.status=lm.estimates[,1]
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/Entropy.Estimates.Status.mat",labpcexport=lm.estimates.status)


#identify regions that are significantly different
significant.regions=which(p.adjust(lm.estimates[,2],n=200,method="BH")<0.05)
print(paste("Number of Regions with Significantly Different Entropy between MCI and HC: ",
            length(significant.regions)))

#find regions where entropy_MCI > entropy_HC, then display them in order of magnitude
mci.greater=significant.regions[which(lm.estimates[significant.regions,]>0)]
print(paste("Number of Regions where entropy_MCI is Significantly Greater than entropy_HC:",
      length(mci.greater)))
#print(paste("Regions (decreasing strength): ",toString(mci.greater[order(lm.estimates[mci.greater,],decreasing=TRUE)])))

#find regions where entropy_HC > entropy_MCI, then display them in order of magnitude
hc.greater=significant.regions[which(lm.estimates[significant.regions,]<0)]
print(paste("Number of Regions where entropy_HC is Significantly Greater than entropy_MCI:",
      length(hc.greater)))
#print(paste("Regions (decreasing strength): ",toString(hc.greater[order(lm.estimates[hc.greater,],decreasing=FALSE)])))

```

#### Brain Plots

-   Entropy
    1.  Comparison: uses estimates from the lm
    2.  HC: just the entropy values for HC
    3.  MCI: just the entropy values for MCI
-   Control energy
    1.  Comparison: uses estimates from the lm
    2.  HC: average CE for each region across HC subjects
    3.  MCI: average CE for each region across MCI subjects

In MATLAB:

-   Visualize cluster centroids

```{r AverageRegionalMetrics, warning=FALSE}

regional.TE=readMat('/Users/daraneumann/Downloads/Research/NCT/Results/AprilRegional.Minimum.CE.mat')$regionalTE[,1,] #import regional CE data

load(file="/Users/daraneumann/Downloads/Research/NCT/Results/Entropy.RData") #import entropy data

dem.data$Status=as.factor(dem.data$Status)


average.regional.CE.HC=colMeans(regional.TE[which(dem.data$Status=="HC"),]) #average CE for HC
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/AprilAverage.Regional.CE.HC.mat",
         labpcexport=average.regional.CE.HC)

average.regional.CE.MCI=colMeans(regional.TE[which(dem.data$Status=="MCI"),]) #average CE for MCI
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/AprilAverage.Regional.CE.MCI.mat",
         labpcexport=average.regional.CE.MCI)



plaque.matrix=unname(as.matrix(plaque[,2:201],nrow=554,ncol=201))

average.regional.plaque.HC=colMeans(plaque.matrix[which(dem.data$Status=="HC"),]) #average plaque for HC
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/Average.Regional.Plaque.HC.mat",
         labpcexport=average.regional.plaque.HC)

average.regional.plaque.MCI=colMeans(plaque.matrix[which(dem.data$Status=="MCI"),]) #average plaque for MCI
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/Average.Regional.Plaque.MCI.mat",
         labpcexport=average.regional.plaque.MCI)



tau.matrix=unname(as.matrix(tau[,2:201],nrow=554,ncol=201))

average.regional.tau.HC=colMeans(tau.matrix[which(dem.data$Status=="HC"),],na.rm=TRUE) #average tau for HC
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/Average.Regional.Tau.HC.mat",
         labpcexport=average.regional.tau.HC)

average.regional.tau.MCI=colMeans(tau.matrix[which(dem.data$Status=="MCI"),],na.rm=TRUE) #average tau for MCI
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/Average.Regional.Tau.MCI.mat",
         labpcexport=average.regional.tau.MCI)



average.regional.entropy.HC=colMeans(entropy[which(dem.data$Status=="HC"),]) #average entropy for HC
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/Average.Regional.Entropy.HC.mat",
         labpcexport=average.regional.entropy.HC)

average.regional.entropy.MCI=colMeans(entropy[which(dem.data$Status=="MCI"),]) #average entropy for MCI
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/Average.Regional.Entropy.MCI.mat",
         labpcexport=average.regional.entropy.MCI)

```

```{r AverageRegionalCET1, warning=FALSE}

regional.TE.T1=readMat('/Users/daraneumann/Downloads/Research/NCT/Results/AprilRegional.Minimum.CE.t1.mat')$regionalTE[,1,] #import regional CE data


dem.data$Status=as.factor(dem.data$Status)


average.regional.CE.HC.T1=colMeans(regional.TE.T1[which(dem.data$Status=="HC"),]) #average CE for HC
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/AprilAverage.Regional.CE.HC.T1.mat",
         labpcexport=average.regional.CE.HC.T1)

average.regional.CE.MCI.T1=colMeans(regional.TE.T1[which(dem.data$Status=="MCI"),]) #average CE for MCI
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/AprilAverage.Regional.CE.MCI.T1.mat",
         labpcexport=average.regional.CE.MCI.T1)


```

#### Bar Plots

```{r NetworkBarPlots, warning=FALSE}

library(ggplot2)
library(viridisLite)

setwd("/Users/daraneumann/Downloads/Research/NCT/Code/EnergyLandscape/data")

sch.232.yeo=as.numeric(read.table("sch232_to_yeo.csv",sep=",",header=FALSE))
sch.200.yeo=sch.232.yeo[1:200] #last 32 regions are subcortex

regional.TE=readMat('/Users/daraneumann/Downloads/Research/NCT/Results/AprilRegional.Minimum.CE.mat')$regionalTE[,1,] #import regional CE data

regional.TE.HC=regional.TE[which(dem.data$Status=="HC"),]
regional.TE.MCI=regional.TE[which(dem.data$Status=="MCI"),]

networknames=c("VIS","SOM","DAN","VAN","LIM","FPN","DMN") #LIM significant before ANCOVA correction
ancova.p.values=NULL
lm.p.values=NULL
lm.estimates=NULL
TE.individual.network=NULL
TE.individual.network.HC=NULL
TE.individual.network.MCI=NULL
TE.network.HC=NULL
TE.network.MCI=NULL


for (i in 1:7){
  TE.individual.network.HC=rowMeans(regional.TE.HC[,which(sch.200.yeo==i)])
  TE.network.HC=rbind(TE.network.HC,mean(TE.individual.network.HC))
  TE.individual.network.MCI=rowMeans(regional.TE.MCI[,which(sch.200.yeo==i)])
  TE.network.MCI=rbind(TE.network.MCI,mean(TE.individual.network.MCI))
  TE.individual.network=rowMeans(regional.TE[,which(sch.200.yeo==i)])
  ancova.per.network=summary(aov(TE.individual.network~Status+Sex+Age+ICV,data=dem.data))
  ancova.per.network1=as.data.frame(ancova.per.network[[1]])
  ancova.p.values=rbind(ancova.p.values,ancova.per.network1$'Pr(>F)'[1])
  lm.per.network=summary(lm(TE.individual.network~Status+Sex+Age+ICV,data=dem.data))
  lm.estimates=rbind(lm.estimates,lm.per.network$coefficients[2,1])
  lm.p.values=rbind(lm.p.values,lm.per.network$coefficients[2,4])
}

adjusted.ancova.p.values=p.adjust(ancova.p.values,n=7,method="BH")
adjusted.lm.p.values=p.adjust(lm.p.values,n=7,method="BH")



#Set parameters for the bar plot colors
plasma.colors=plasma(10) #generate a sequence of 10 colors from the plasma palette
viridis.colors=viridis(10) #generate a sequence of 10 colors from the viridis palette
significance.colors=c("NS"="#B2192C", #orange for non-sigificant values
                      "SBC"=viridis.colors[6], #pink for significant before correction
                      "SAC"=viridis.colors[4]) #purple for significant before correction

#Find significantly different regions using lm
networknames[which(lm.p.values<0.05)]
networknames[which(adjusted.lm.p.values<0.05)]

#Create bar plot for lm estimates
data.plot=data.frame(Network=c("VIS","SOM","DAN","VAN","LIM","FPN","DMN"),
                     Value=lm.estimates,
                     Significance=c("NS","NS","NS","NS","SAC","NS","NS"))

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/")
png(file="TE.Network.Bar.Plot.Comparison.png",width=600,height=1000)

ggplot(data.plot,aes(x=Network,y=Value,fill=Value)) +
  geom_bar(stat="identity") +
  scale_fill_gradientn(colors=colorRampPalette(rev(brewer.pal(11,"RdBu")))(100)) +
  coord_flip() +
  theme_minimal() +
  labs(title="",x="Network",y="Estimates") +
  theme(axis.text.x=element_text(angle=45,hjust=1))+
  theme(legend.position="none",
        axis.title=element_text(size=30), #increase axis title size
        axis.text=element_text(size=30),legend.text=element_text(size=30),
        legend.title=element_text(size=30))
dev.off()


#Create bar plot for HC
data.plot=data.frame(Network=c("VIS","SOM","DAN","VAN","LIM","FPN","DMN"),
                     Value=TE.network.HC)

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/")
png(file="TE.Network.Bar.Plot.HC.png",width=600,height=1000)

ggplot(data.plot,aes(x=Network,y=Value)) +
  geom_bar(stat="identity",fill=plasma.colors[6]) +
  coord_flip() +
  theme_minimal() +
  labs(title="",x="Network",y="Estimates") +
  theme(axis.text.x=element_text(angle=45,hjust=1))+
  theme(legend.position="none",
        axis.title=element_text(size=30), #increase axis title size
        axis.text=element_text(size=30),legend.text=element_text(size=30),
        legend.title=element_text(size=30))
dev.off()


#Create bar plot for MCI
data.plot=data.frame(Network=c("VIS","SOM","DAN","VAN","LIM","FPN","DMN"),
                     Value=TE.network.MCI)

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/")
png(file="TE.Network.Bar.Plot.MCI.png",width=600,height=1000)

ggplot(data.plot,aes(x=Network,y=Value)) +
  geom_bar(stat="identity",fill=plasma.colors[6]) +
  coord_flip() +
  theme_minimal() +
  labs(title="",x="Network",y="Estimates") +
  theme(axis.text.x=element_text(angle=45,hjust=1))+
  theme(legend.position="none",
        axis.title=element_text(size=30), #increase axis title size
        axis.text=element_text(size=30),legend.text=element_text(size=30),
        legend.title=element_text(size=30))
dev.off()

```

```{r NetworkBarPlotsEntropyTE, warning=FALSE}

library(ggplot2)
library(viridisLite)

setwd("/Users/daraneumann/Downloads/Research/NCT/Code/EnergyLandscape/data")

sch.232.yeo=as.numeric(read.table("sch232_to_yeo.csv",sep=",",header=FALSE))
sch.200.yeo=sch.232.yeo[1:200] #last 32 regions are subcortex

regional.TE=readMat('/Users/daraneumann/Downloads/Research/NCT/Results/AprilRegional.Minimum.CE.mat')$regionalTE[,1,] #import regional CE data

#find how many regions have positive and negative lm estimates

TE.individual.region=NULL
entropy.individual.region=NULL
lm.region=NULL
lm.estimates.region=NULL
p.values.region=NULL

for (i in 1:200){
  TE.individual.region=regional.TE[,i]
  entropy.individual.region=entropy[,i]
  lm.region=summary(lm(TE.individual.region~entropy.individual.region+Sex+Age+ICV,data=dem.data))
  lm.estimates.region=rbind(lm.estimates.region,lm.region$coefficients[2,1])
  p.values.region=rbind(p.values.region,lm.region$coefficients[2,4])
}

significant.regions=which(p.adjust(p.values.region,n=200,method="BH")<0.05)
print(paste("Number of Regions with Significantly Association Between TE and Entropy: ",
            length(significant.regions)))

#find number regions where there is any positive association (significant or not)
positive.association=which(lm.estimates.region>0)
print(paste("Number of Regions with any Positive Association (not necessarily significant):",
      length(positive.association)))

#find number regions where there is a significant positive association
positive.association.sig=significant.regions[which(lm.estimates.region[significant.regions,]>0)]
print(paste("Number of Regions with Significant Positive Association:",
      length(positive.association.sig)))


networknames=c("VIS","SOM","DAN","VAN","LIM","FPN","DMN") #LIM significant before ANCOVA correction
lm.p.values=NULL
lm.estimates=NULL
TE.individual.network=NULL


for (i in 1:7){
  TE.individual.network=rowMeans(regional.TE[,which(sch.200.yeo==i)])
  entropy.individual.network=rowMeans(entropy[,which(sch.200.yeo==i)])
  lm.per.network=summary(lm(TE.individual.network~entropy.individual.network+Sex+Age+ICV,data=dem.data))
  lm.estimates=rbind(lm.estimates,lm.per.network$coefficients[2,1])
  lm.p.values=rbind(lm.p.values,lm.per.network$coefficients[2,4])
}

adjusted.ancova.p.values=p.adjust(ancova.p.values,n=7,method="BH")
adjusted.lm.p.values=p.adjust(lm.p.values,n=7,method="BH")



#Set parameters for the bar plot colors
plasma.colors=plasma(10) #generate a sequence of 10 colors from the plasma palette
viridis.colors=viridis(10) #generate a sequence of 10 colors from the viridis palette
significance.colors=c("NS"="#B2192C", #red for positive estimates
                      "SBC"=viridis.colors[6], #green for significant before correction
                      "SAC"=viridis.colors[4]) #blue for negative estimates

#Find significantly different regions using lm
networknames[which(lm.p.values<0.05)]
networknames[which(adjusted.lm.p.values<0.05)]

#Create bar plot for lm estimates
data.plot=data.frame(Network=c("VIS","SOM","DAN","VAN","LIM","FPN","DMN"),
                     Value=lm.estimates,
                     Significance=c("NS","NS","NS","NS","NS","SAC","NS"))

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/")
png(file="TE.Entropy.Network.Bar.Plot.Comparison.png",width=600,height=1000)

ggplot(data.plot,aes(x=Network,y=Value,fill=Value)) +
  geom_bar(stat="identity") +
  scale_fill_gradientn(colors=colorRampPalette(rev(brewer.pal(11,"RdBu")))(100)) +
  coord_flip() +
  theme_minimal() +
  labs(title="",x="Network",y="Estimates") +
  theme(axis.text.x=element_text(angle=45,hjust=1))+
  theme(legend.position="none",
        axis.title=element_text(size=30), #increase axis title size
        axis.text=element_text(size=30),legend.text=element_text(size=30),
        legend.title=element_text(size=30))
dev.off()

```

```{r NetworkBarPlotsT1, warning=FALSE}

library(ggplot2)
library(viridisLite)

setwd("/Users/daraneumann/Downloads/Research/NCT/Code/EnergyLandscape/data")

sch.232.yeo=as.numeric(read.table("sch232_to_yeo.csv",sep=",",header=FALSE))
sch.200.yeo=sch.232.yeo[1:200] #last 32 regions are subcortex

regional.TE=readMat('/Users/daraneumann/Downloads/Research/NCT/Results/AprilRegional.Minimum.CE.T1.mat')$regionalTE[,1,] #import regional CE data

regional.TE.HC=regional.TE[which(dem.data$Status=="HC"),]
regional.TE.MCI=regional.TE[which(dem.data$Status=="MCI"),]

networknames=c("VIS","SOM","DAN","VAN","LIM","FPN","DMN") #LIM significant before ANCOVA correction
ancova.p.values=NULL
lm.p.values=NULL
lm.estimates=NULL
TE.individual.network=NULL
TE.individual.network.HC=NULL
TE.individual.network.MCI=NULL
TE.network.HC=NULL
TE.network.MCI=NULL


for (i in 1:7){
  TE.individual.network.HC=rowMeans(regional.TE.HC[,which(sch.200.yeo==i)])
  TE.network.HC=rbind(TE.network.HC,mean(TE.individual.network.HC))
  TE.individual.network.MCI=rowMeans(regional.TE.MCI[,which(sch.200.yeo==i)])
  TE.network.MCI=rbind(TE.network.MCI,mean(TE.individual.network.MCI))
  TE.individual.network=rowMeans(regional.TE[,which(sch.200.yeo==i)])
  ancova.per.network=summary(aov(TE.individual.network~Status+Sex+Age+ICV,data=dem.data))
  ancova.per.network1=as.data.frame(ancova.per.network[[1]])
  ancova.p.values=rbind(ancova.p.values,ancova.per.network1$'Pr(>F)'[1])
  lm.per.network=summary(lm(TE.individual.network~Status+Sex+Age+ICV,data=dem.data))
  lm.estimates=rbind(lm.estimates,lm.per.network$coefficients[2,1])
  lm.p.values=rbind(lm.p.values,lm.per.network$coefficients[2,4])
}

adjusted.ancova.p.values=p.adjust(ancova.p.values,n=7,method="BH")
adjusted.lm.p.values=p.adjust(lm.p.values,n=7,method="BH")



#Set parameters for the bar plot colors
plasma.colors=plasma(10) #generate a sequence of 10 colors from the plasma palette
viridis.colors=viridis(10) #generate a sequence of 10 colors from the viridis palette
significance.colors=c("NS"="#B2192C", #orange for non-sigificant values
                      "SBC"=viridis.colors[6], #pink for significant before correction
                      "SAC"=viridis.colors[4]) #purple for significant before correction

#Find significantly different regions using lm
networknames[which(lm.p.values<0.05)]
networknames[which(adjusted.lm.p.values<0.05)]

#Create bar plot for lm estimates
data.plot=data.frame(Network=c("VIS","SOM","DAN","VAN","LIM","FPN","DMN"),
                     Value=lm.estimates,
                     Significance=c("NS","NS","NS","NS","SAC","NS","NS"))

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/")
png(file="TE.Network.Bar.Plot.Comparison.T1.png",width=600,height=1000)

ggplot(data.plot,aes(x=Network,y=Value,fill=Value)) +
  geom_bar(stat="identity") +
  scale_fill_gradientn(colors=colorRampPalette(rev(brewer.pal(11,"RdBu")))(100)) +
  coord_flip() +
  theme_minimal() +
  labs(title="",x="Network",y="Estimates") +
  theme(axis.text.x=element_text(angle=45,hjust=1))+
  theme(legend.position="none",
        axis.title=element_text(size=30), #increase axis title size
        axis.text=element_text(size=30),legend.text=element_text(size=30),
        legend.title=element_text(size=30))
dev.off()


#Create bar plot for HC
data.plot=data.frame(Network=c("VIS","SOM","DAN","VAN","LIM","FPN","DMN"),
                     Value=TE.network.HC)

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/")
png(file="TE.Network.Bar.Plot.HC.T1.png",width=600,height=1000)

ggplot(data.plot,aes(x=Network,y=Value)) +
  geom_bar(stat="identity",fill=plasma.colors[6]) +
  coord_flip() +
  theme_minimal() +
  labs(title="",x="Network",y="Estimates") +
  theme(axis.text.x=element_text(angle=45,hjust=1))+
  theme(legend.position="none",
        axis.title=element_text(size=30), #increase axis title size
        axis.text=element_text(size=30),legend.text=element_text(size=30),
        legend.title=element_text(size=30))
dev.off()


#Create bar plot for MCI
data.plot=data.frame(Network=c("VIS","SOM","DAN","VAN","LIM","FPN","DMN"),
                     Value=TE.network.MCI)

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/")
png(file="TE.Network.Bar.Plot.MCI.T1.png",width=600,height=1000)

ggplot(data.plot,aes(x=Network,y=Value)) +
  geom_bar(stat="identity",fill=plasma.colors[6]) +
  coord_flip() +
  theme_minimal() +
  labs(title="",x="Network",y="Estimates") +
  theme(axis.text.x=element_text(angle=45,hjust=1))+
  theme(legend.position="none",
        axis.title=element_text(size=30), #increase axis title size
        axis.text=element_text(size=30),legend.text=element_text(size=30),
        legend.title=element_text(size=30))
dev.off()


```

------------------------------------------------------------------------

## Global

```{r Global, warning=FALSE}

global.TE=readMat('/Users/daraneumann/Downloads/Research/NCT/Results/AprilGlobal.Minimum.CE.mat')$globalTE

t.test(global.TE[which(dem.data$Status=="MCI")],
       global.TE[which(dem.data$Status=="HC")])

#summary(aov(global.TE~Status+Sex+Age+ICV,data=dem.data))
summary(lm(global.TE~Status+Sex+Age+ICV,data=dem.data))



global.entropy=rowMeans(entropy)

t.test(global.entropy[which(dem.data$Status=="MCI")],
       global.entropy[which(dem.data$Status=="HC")])

#summary(aov(global.entropy~Status+Sex+Age+ICV,data=dem.data))
summary(lm(global.entropy~Status+Sex+Age+ICV,data=dem.data))



global.plaque=rowMeans(plaque[,2:201],na.rm=TRUE)

t.test(global.plaque[which(dem.data$Status=="MCI")],
       global.plaque[which(dem.data$Status=="HC")])

#summary(aov(global.plaque~Status+Sex+Age+ICV,data=dem.data))
summary(lm(global.plaque~Status+Sex+Age+ICV,data=dem.data))


global.tau=rowMeans(tau[,2:201],na.rm=TRUE)

t.test(global.tau[which(dem.data$Status=="MCI")],
       global.tau[which(dem.data$Status=="HC")])

summary(aov(global.tau~Status+Sex+Age+ICV,data=dem.data))
summary(lm(global.tau~Status+Sex+Age+ICV,data=dem.data))

```

```{r GlobalT1, warning=FALSE}

global.TE.T1=readMat('/Users/daraneumann/Downloads/Research/NCT/Results/AprilGlobal.Minimum.CE.T1.mat')$globalTE

t.test(global.TE.T1[which(dem.data$Status=="MCI")],
       global.TE.T1[which(dem.data$Status=="HC")])

#print(summary(aov(global.TE.T1~Status+Sex+Age+ICV,data=dem.data)))
print(summary(lm(global.TE.T1~Status+Sex+Age+ICV,data=dem.data)))

```

#### Violin Plots

-   Comparing global TE (plot 1), global entropy (plot 2), global plaque (plot 3), global tau (plot 4)

```{r ViolinPlotTE, warning=FALSE}

library(ggplot2)
library(gridExtra)

global.TE=readMat('/Users/daraneumann/Downloads/Research/NCT/Results/AprilGlobal.Minimum.CE.mat')$globalTE

colors=c("#00AFBB","#08EFFF")
data=data.frame(group=dem.data$Status,y=global.TE)

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/")
pdf(file="AprilViolin.Global.CE.pdf")

ggplot(data=data,
  aes(x=group,y=y,fill=group))+   
  geom_violin(trim=FALSE)+
  geom_boxplot(width=0.1,fill="white")+
  labs(title="",x="",y="Global Transition Energy")+
  scale_fill_manual(values=rep(colors,1))+
  scale_x_discrete(labels=c("HC","MCI"))+
  theme(legend.position="none",axis.text.x=element_text(size=6))

```

```{r ViolinPlotTET1, warning=FALSE}

library(ggplot2)
library(gridExtra)

global.TE.T1=readMat('/Users/daraneumann/Downloads/Research/NCT/Results/AprilGlobal.Minimum.CE.T1.mat')$globalTE

colors=c("#00AFBB","#08EFFF")
data=data.frame(group=dem.data$Status,y=global.TE.T1)

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/")
pdf(file="AprilViolin.Global.CE.T1.pdf")

ggplot(data=data,
  aes(x=group,y=y,fill=group))+   
  geom_violin(trim=FALSE)+
  geom_boxplot(width=0.1,fill="white")+
  labs(title="",x="",y="Global Transition Energy")+
  scale_fill_manual(values=rep(colors,1))+
  scale_x_discrete(labels=c("HC","MCI"))+
  theme(legend.position="none",axis.text.x=element_text(size=6))
```

```{r ViolinPlotEntropy, warning=FALSE}

library(ggplot2)
library(gridExtra)

colors=c("#00AFBB","#08EFFF")
data=data.frame(group=dem.data$Status,y=global.entropy)

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/")
pdf(file="Violin.Global.Entropy.pdf")

ggplot(data=data,
  aes(x=group,y=y,fill=group))+   
  geom_violin(trim=FALSE)+
  geom_boxplot(width=0.1,fill="white")+
  labs(title="",x="",y="Global Entropy")+
  scale_fill_manual(values=rep(colors,1))+
  scale_x_discrete(labels=c("HC","MCI"))+
  theme(legend.position="none",axis.text.x=element_text(size=6))

```

```{r ViolinPlotPlaque, warning=FALSE}

library(ggplot2)
library(gridExtra)

colors=c("#00AFBB","#08EFFF")
data=data.frame(group=dem.data$Status,y=global.plaque)

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/")
pdf(file="Violin.Global.Plaque.pdf")

ggplot(data=data,
  aes(x=group,y=y,fill=group))+   
  geom_violin(trim=FALSE)+
  geom_boxplot(width=0.1,fill="white")+
  labs(title="",x="",y="Global Amyloid Beta Plaque Level")+ #units are standard uptake value ratio (SUVR)
  scale_fill_manual(values=rep(colors,1))+
  scale_x_discrete(labels=c("HC","MCI"))+
  theme(legend.position="none",axis.text.x=element_text(size=6))

```

```{r ViolinPlotTau, warning=FALSE}

library(ggplot2)
library(gridExtra)

colors=c("#00AFBB","#08EFFF")
data=data.frame(group=dem.data$Status,y=global.tau)

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/")
pdf(file="Violin.Global.Tau.pdf")

ggplot(data=data,
  aes(x=group,y=y,fill=group))+   
  geom_violin(trim=FALSE)+
  geom_boxplot(width=0.1,fill="white")+
  labs(title="",x="",y="Global Tau Protein Level")+ #units are standard uptake value ratio (SUVR)
  scale_fill_manual(values=rep(colors,1))+
  scale_x_discrete(labels=c("HC","MCI"))+
  theme(legend.position="none",axis.text.x=element_text(size=6))

```

#### Box Plots

```{r Boxplots, warning=FALSE}

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/")
pdf(file="Boxplot.Global.Transition.Energy.Entropy.k6.pdf",width=12,height=8)
par(mfrow=c(2,2))

col1=heat.colors(20)[c(3,9)]
  
boxplot(rowMeans(minimumcontrolenergy)[which(dem.data$Status=="MCI")],
        rowMeans(minimumcontrolenergy)[which(dem.data$Status=="HC")],
        col=col1,names=c("MCI \n n = 55","HC \n n = 499"),
        main="Global Transition Energy")
  
boxplot(rowMeans(minimumcontrolenergy)[which(dem.data$Status=="MCI")],
        rowMeans(minimumcontrolenergy)[which(dem.data$Status=="HC")],
        col=col1,names=c("MCI \n n = 55","HC \n n = 499"),outline=FALSE,
        main="Global Transition Energy (no outliers)")
  
boxplot(rowMeans(entropy)[which(dem.data$Status=="MCI")],
        rowMeans(entropy)[which(dem.data$Status=="HC")],
        col=col1,names=c("MCI \n n = 55","HC \n n = 499"),
        main="Global Entropy")
  
boxplot(rowMeans(entropy)[which(data$Status=="MCI")],
        rowMeans(entropy)[which(data$Status=="HC")],
        col=col1,names=c("MCI \n n = 55","HC \n n = 499"),outline=FALSE,
        main="Global Entropy (no outliers)")
  
dev.off() 

```

```{r BoxplotFigures, warning=FALSE}

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/")
pdf(file="Figure.Boxplot.Global.TE.Entropy.pdf",width=12,height=8)
par(mfrow=c(1,2))

col1=heat.colors(20)[c(3,9)]
  
boxplot(rowMeans(minimumcontrolenergy)[which(dem.data$Status=="MCI")],
        rowMeans(minimumcontrolenergy)[which(dem.data$Status=="HC")],
        col=col1,names=c("MCI \n n = 55","HC \n n = 499"),
        main="Global Transition Energy Comparison")

boxplot(rowMeans(entropy)[which(dem.data$Status=="MCI")],
        rowMeans(entropy)[which(dem.data$Status=="HC")],
        col=col1,names=c("MCI \n n = 55","HC \n n = 499"),
        main="Global Entropy Comparison")

dev.off()

```

#### Scatter Plots

```{r CorrelationTE.TP, warning=FALSE}

TE.TP.cor=NULL
for(i in 1:554) { #correlation for each subject
  TE.TP.cor=rbind(TE.TP.cor,cor.test(minimumcontrolenergyt1[i,],transition_prob_persubject[i,]))
}

print(TE.TP.cor[1:5,1:7])

global.cor=cor.test(rank(colMeans(transition_prob_persubject)),rank(colMeans(minimumcontrolenergyt1)))
global.cor

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create scatter plot
pdf(file="Correlation.TE.TP.pdf",width=8,height=8)
par(mfrow=c(1,1))
z=as.numeric(as.factor(data$Status)) #turn MCI and HC into binary numbers
plot(rank(colMeans(transition_prob_persubject)),rank(colMeans(minimumcontrolenergy)),
     xlab="Transition Energy (rank)",ylab="Global Transition Energy (rank)",
     main=paste("Pearson Correlation =",round(global.cor$estimate,7),"\n p = ",round(global.cor$p.value,7)),
     col=c("black","blue","red")[z],pch=19)
abline(lm(rank(colMeans(minimumcontrolenergy))~rank(colMeans(transition_prob_persubject))),col="red",lwd=2)

```

```{r OldScatterEntropyCE, warning=FALSE}

correlation.CE.entropy=cor.test(global.TE,rowMeans(entropy))
correlation.CE.entropy

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create scatter plot
png(file="Scatter.Entropy.CE.png",width=1000,height=600)


status=as.numeric(as.factor(data$Status)) #turn MCI and HC into binary numbers


plot(global.TE,
     rowMeans(entropy),
     xlab="Average Transition Energy",
     ylab="Average Regional Entropy",
     main="Global Transition Energy vs. Global Entropy",
     col=c("#FFC72C","#B31B1B")[status],pch=19)

mtext(paste("Pearson Correlation =",
            round(correlation.CE.entropy$estimate,7),
            "\n p = ",round(correlation.CE.entropy$p.value,7)),
      side=3,line=-0.03,cex=0.8)

abline(lm(rowMeans(entropy)~global.TE),
       col="red",lwd=2)

legend("topright",legend=c("HC","MCI"),col=c("#FFC72C","#B31B1B"),pch=19)

dev.off()

```

```{r OldScatterCEPlaque, warning=FALSE}

correlation.CE.plaque=cor.test(global.TE,global.plaque)
correlation.CE.plaque

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create scatter plot
png(file="Scatter.CE.Plaque.png",width=1000,height=600)


z=as.numeric(as.factor(data$Status)) #turn MCI and HC into binary numbers

plot(global.TE,
     global.plaque,
     xlab="Average Transition Energy",
     ylab="Average Amyloid Beta Plaque Level",
     main="Global Transition Energy vs. Global Amyloid Beta Plaque",
     col=c("#FFC72C","#B31B1B"),pch=19) #col=c("#00AFBB","magenta")[z],pch=19)

mtext(paste("Pearson Correlation =",
            round(correlation.CE.plaque$estimate,7),
            "\n p = ",round(correlation.CE.plaque$p.value,7)),
      side=3,line=-0.03,cex=0.8)

abline(lm(global.plaque~global.TE),
       col="red",lwd=2)

legend("topright",legend=c("HC","MCI"),col=c("#FFC72C","#B31B1B"),pch=19)

dev.off()

```

```{r OldScatterCETau, warning=FALSE}

correlation.CE.tau=cor.test(global.TE,global.tau)
correlation.CE.tau

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create scatter plot
png(file="Scatter.CE.Tau.png",width=1000,height=600)


z=as.numeric(as.factor(data$Status)) #turn MCI and HC into binary numbers

plot(global.TE,
     global.tau,
     xlab="Average Transition Energy",
     ylab="Average Amyloid Tau Protein Level",
     main="Global Transition Energy vs. Global Tau Protein",
     col=c("#FFC72C","#B31B1B"),pch=19) #col=c("#00AFBB","magenta")[z],pch=19)

mtext(paste("Pearson Correlation =",
            round(correlation.CE.tau$estimate,7),
            "\n p = ",round(correlation.CE.tau$p.value,7)),
      side=3,line=-0.03,cex=0.8)

abline(lm(global.tau~global.TE),
       col="red",lwd=2)

legend("topright",legend=c("HC","MCI"),col=c("#FFC72C","#B31B1B"),pch=19)

dev.off()

```

```{r OldScatterEntropyPlaque, warning=FALSE}

correlation.entropy.plaque=cor.test(rowMeans(entropy),global.plaque)
correlation.entropy.plaque

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create scatter plot
png(file="Scatter.Entropy.Plaque.png",width=1000,height=600)


z=as.numeric(as.factor(data$Status)) #turn MCI and HC into binary numbers

plot(rowMeans(entropy),
     global.plaque,
     xlab="Average Regional Entropy",
     ylab="Average Regional Amyloid Beta Plaque Level",
     main="Global Entropy vs. Global Amyloid Beta Plaque",
     col=c("#FFC72C","#B31B1B"),pch=19) #col=c("#00AFBB","magenta")[z],pch=19)

mtext(paste("Pearson Correlation =",
            round(correlation.entropy.plaque$estimate,7),
            "\n p = ",round(correlation.entropy.plaque$p.value,7)),
      side=3,line=-0.03,cex=0.8)

abline(lm(global.plaque~rowMeans(entropy)),
       col="red",lwd=2)

legend("topright",legend=c("HC","MCI"),col=c("#FFC72C","#B31B1B"),pch=19)

dev.off()

```

```{r OldScatterEntropyPlaque2, warning=FALSE}

library(gridExtra)
library(ggplot2)
library(ggpubr)
library(ppcor)

correlation.entropy.plaque=cor.test(rowMeans(entropy),global.plaque)
correlation.entropy.plaque

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create scatter plot
png(file="Scatter.Entropy.Plaque.png",width=1000,height=600)

colors=c("#00AFBB","#B31B1B") #c("#00AFBB","#08EFFF") c("#FFC72C","#B31B1B")
data=data.frame(status=dem.data$Status, #compile all data for scatterplots
                age=dem.data$Age,
                TE=global.TE,
                entropy=rowMeans(entropy),
                tau=global.tau,
                plaque=global.plaque)

ggplot(data=data,
  aes(x=entropy,y=plaque)) +
  geom_point(aes(color=status),size=3) + #point colors by status
  geom_smooth(method="lm",se=TRUE,aes(fill=status,color=status),size=1.5) + #regression by status
  geom_smooth(method="lm",se=FALSE,colour="black",linetype="dashed",size=2) +
  theme(axis.title=element_text(size=20), #text size
        axis.text=element_text(size=20),
        plot.title=element_text(size=20)) +
  labs(title="",x="Average Regional Entropy",y="Average Amyloid Beta Plaque Level") +
  scale_color_manual(values=c("HC"=colors[1],"MCI"=colors[2])) +
  scale_fill_manual(values=c("HC"=colors[1],"MCI"=colors[2])) +
  stat_cor(data=data[data$status=="HC",],
           method="spearman",label.x=min(data$entropy),label.y=max(data$plaque),
           color=colors[1],size=8,cor.coef.name="rho") +
  stat_cor(data=data[data$status=="MCI",],
           method="spearman",label.x=min(data$entropy),label.y=max(data$plaque)-0.08,
           color=colors[2],size=8,cor.coef.name="rho") +
  stat_cor(data=data,
           method="spearman",label.x=min(data$entropy),label.y=max(data$plaque)-0.16,
           color="black",size=8,cor.coef.name="rho")

```

```{r OldScatterEntropyTau, warning=FALSE}

correlation.entropy.tau=cor.test(rowMeans(entropy),global.tau)
correlation.entropy.tau

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create scatter plot
png(file="Scatter.Entropy.Tau.png",width=1000,height=600)


z=as.numeric(as.factor(data$Status)) #turn MCI and HC into binary numbers

plot(rowMeans(entropy),
     global.tau,
     xlab="Average Regional Entropy",
     ylab="Average Regional Tau Protein Level",
     main="Global Entropy vs. Global Tau Protein",
     col=c("#FFC72C","#B31B1B"),pch=19) #col=c("#00AFBB","magenta")[z],pch=19)

mtext(paste("Pearson Correlation =",
            round(correlation.entropy.tau$estimate,7),
            "\n p = ",round(correlation.entropy.tau$p.value,7)),
      side=3,line=-0.03,cex=0.8)

abline(lm(global.tau~rowMeans(entropy)),
       col="red",lwd=2)

legend("topright",legend=c("HC","MCI"),col=c("#FFC72C","#B31B1B"),pch=19)

dev.off()

```

```{r OldScatterEntropyTau2, warning=FALSE}

library(gridExtra)
library(ggplot2)
library(ggpubr)
library(ppcor)

correlation.entropy.tau=cor.test(rowMeans(entropy),global.tau)
correlation.entropy.tau

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create scatter plot
png(file="Scatter.Entropy.Tau.png",width=1000,height=600)

colors=c("#00AFBB","#B31B1B") #c("#00AFBB","#08EFFF") c("#FFC72C","#B31B1B")
data=data.frame(status=dem.data$Status, #compile all data for scatterplots
                age=dem.data$Age,
                TE=global.TE,
                entropy=rowMeans(entropy),
                tau=global.tau,
                plaque=global.plaque)

data$tau[is.na(data$tau)]=mean(data$tau,na.rm=TRUE) #replace NA values with the mean of the column

ggplot(data=data,
  aes(x=entropy,y=tau)) +
  geom_point(aes(color=status),size=3) + #point colors by status
  geom_smooth(method="lm",se=TRUE,aes(fill=status,color=status),size=1.5) + #regression by status
  geom_smooth(method="lm",se=FALSE,colour="black",linetype="dashed",size=2) +
  theme(axis.title=element_text(size=20), #text size
        axis.text=element_text(size=20),
        plot.title=element_text(size=20)) +
  labs(title="",x="Average Regional Entropy",y="Average Tau Protein Level") +
  scale_color_manual(values=c("HC"=colors[1],"MCI"=colors[2])) +
  scale_fill_manual(values=c("HC"=colors[1],"MCI"=colors[2])) +
  stat_cor(data=data[data$status=="HC",],
           method="spearman",label.x=min(data$entropy),label.y=max(data$tau),
           color=colors[1],size=8,cor.coef.name="rho") +
  stat_cor(data=data[data$status=="MCI",],
           method="spearman",label.x=min(data$entropy),label.y=max(data$tau)-0.25,
           color=colors[2],size=8,cor.coef.name="rho") +
  stat_cor(data=data,
           method="spearman",label.x=min(data$entropy),label.y=max(data$tau)-0.5,
           color="black",size=8,cor.coef.name="rho")

```

```{r OldScatterAgeCE, warning=FALSE}

correlation.CE.age=cor.test(dem.data$Age,global.TE)
correlation.CE.age

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create scatter plot
png(file="Scatter.CE.Age.png",width=1000,height=600)

z=as.numeric(as.factor(data$Status)) #turn MCI and HC into binary numbers

plot(dem.data$Age,
     global.TE,
     xlab="Age",
     ylab="Average Transition Energy",
     main="Global Transition Energy vs. Age",
     col=c("#FFC72C","#B31B1B"),pch=19)

mtext(paste("Pearson Correlation =",
            round(correlation.CE.age$estimate,7),
            "\n p = ",round(correlation.CE.age$p.value,7)),
      side=3,line=-0.03,cex=0.8)

abline(lm(global.TE~dem.data$Age),
       col="red",lwd=2)

legend("topright",legend=c("HC","MCI"),col=c("#FFC72C","#B31B1B"),pch=19)

dev.off()

```

```{r OldScatterAgeEntropy, warning=FALSE}

correlation.entropy.age=cor.test(dem.data$Age,rowMeans(entropy))
correlation.entropy.age

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create scatter plot
png(file="Scatter.Entropy.Age.png",width=1000,height=600)

z=as.numeric(as.factor(data$Status)) #turn MCI and HC into binary numbers

plot(dem.data$Age,
     rowMeans(entropy),
     xlab="Age",
     ylab="Average Regional Entropy",
     main="Global Entropy vs. Age",
     col=c("#FFC72C","#B31B1B"),pch=19)

mtext(paste("Pearson Correlation =",
            round(correlation.entropy.age$estimate,7),
            "\n p = ",round(correlation.entropy.age$p.value,7)),
      side=3,line=-0.03,cex=0.8)

abline(lm(rowMeans(entropy)~dem.data$Age),
       col="red",lwd=2)

legend("topright",legend=c("HC","MCI"),col=c("#FFC72C","#B31B1B"),pch=19)

dev.off()

```

##### CE

```{r ScatterEntropyCE, warning=FALSE}

library(gridExtra)
library(ggplot2)
library(ggpubr)
library(ppcor)

global.TE=readMat('/Users/daraneumann/Downloads/Research/NCT/Results/AprilGlobal.Minimum.CE.mat')$globalTE

correlation.CE.entropy=cor.test(global.TE,rowMeans(entropy),method='spearman')
correlation.CE.entropy

global.lm.TE.entropy=summary(lm(as.numeric(global.TE)~global.entropy+Sex+Age+ICV,data=dem.data))
global.lm.TE.entropy

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create scatter plot
png(file="AprilScatter.Entropy.CE.png",width=1000,height=600)

colors=c("#B12B8F","#00AFBB") #c("#00AFBB","#08EFFF") c("#FFC72C","#B31B1B")
#colors=c("#00AFBB","#B31B1B") #c("#00AFBB","#08EFFF") c("#FFC72C","#B31B1B")
data=data.frame(status=dem.data$Status, #compile all data for scatterplots
                age=dem.data$Age,
                sex=dem.data$Sex,
                icv=dem.data$ICV,
                TE=global.TE,
                entropy=rowMeans(entropy),
                tau=global.tau,
                plaque=global.plaque)

ggplot(data=data,
  aes(x=TE,y=entropy)) +
  geom_point(aes(color=status),size=3) + #point colors by status
  geom_smooth(method="lm",se=TRUE,aes(fill=status,color=status),size=1.5) + #regression by status
  geom_smooth(method="lm",se=FALSE,colour="black",linetype="dashed",size=2) +
  theme(axis.title=element_text(size=20), #text size
        axis.text=element_text(size=20),
        plot.title=element_text(size=20)) +
  labs(title="",x="Average Transition Energy",y="Average Regional Entropy") +
  scale_color_manual(values=c("HC"=colors[1],"MCI"=colors[2])) +
  scale_fill_manual(values=c("HC"=colors[1],"MCI"=colors[2])) # +
#  stat_cor(data=data[data$status=="HC",],
#           method="spearman",label.x=min(data$TE),label.y=max(data$entropy),
#           color=colors[1],size=8,cor.coef.name="rho") +
#  stat_cor(data=data[data$status=="MCI",],
#           method="spearman",label.x=min(data$TE),label.y=max(data$entropy)-0.08,
#           color=colors[2],size=8,cor.coef.name="rho") +
# stat_cor(data=data,
#           method="spearman",label.x=min(data$TE),label.y=max(data$entropy)-0.16,
#           color="black",size=8,cor.coef.name="rho")

lm.hc.TE.entropy=summary(lm(as.numeric(TE)~entropy+sex+age+icv,data=data[data$status=="HC",]))
lm.hc.TE.entropy
lm.mci.TE.entropy=summary(lm(as.numeric(TE)~entropy+sex+age+icv,data=data[data$status=="MCI",]))
lm.mci.TE.entropy

```

```{r ScatterEntropyCET1, warning=FALSE}

library(gridExtra)
library(ggplot2)
library(ggpubr)
library(ppcor)

global.TE.T1=readMat('/Users/daraneumann/Downloads/Research/NCT/Results/AprilGlobal.Minimum.CE.T1.mat')$globalTE

correlation.CE.entropy.T1=cor.test(global.TE.T1,rowMeans(entropy))
correlation.CE.entropy.T1

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create scatter plot
png(file="AprilScatter.Entropy.CE.T1.png",width=1000,height=600)

colors=c("#B12B8F","#00AFBB") #c("#00AFBB","#08EFFF") c("#FFC72C","#B31B1B")
#colors=c("#00AFBB","#B31B1B") #c("#00AFBB","#08EFFF") c("#FFC72C","#B31B1B")
data=data.frame(status=dem.data$Status, #compile all data for scatterplots
                age=dem.data$Age,
                TE=global.TE.T1,
                entropy=rowMeans(entropy),
                tau=global.tau,
                plaque=global.plaque)

ggplot(data=data,
  aes(x=TE,y=entropy)) +
  geom_point(aes(color=status),size=3) + #point colors by status
  geom_smooth(method="lm",se=TRUE,aes(fill=status,color=status),size=1.5) + #regression by status
  geom_smooth(method="lm",se=FALSE,colour="black",linetype="dashed",size=2) +
  theme(axis.title=element_text(size=20), #text size
        axis.text=element_text(size=20),
        plot.title=element_text(size=20)) +
  labs(title="",x="Average Transition Energy",y="Average Regional Entropy") +
  scale_color_manual(values=c("HC"=colors[1],"MCI"=colors[2])) +
  scale_fill_manual(values=c("HC"=colors[1],"MCI"=colors[2])) +
  stat_cor(data=data[data$status=="HC",],
           method="spearman",label.x=min(data$TE),label.y=max(data$entropy),
           color=colors[1],size=8,cor.coef.name="rho") +
  stat_cor(data=data[data$status=="MCI",],
           method="spearman",label.x=min(data$TE),label.y=max(data$entropy)-0.08,
           color=colors[2],size=8,cor.coef.name="rho") +
  stat_cor(data=data,
           method="spearman",label.x=min(data$TE),label.y=max(data$entropy)-0.16,
           color="black",size=8,cor.coef.name="rho")

```

```{r ScatterCEPlaque, warning=FALSE}

library(gridExtra)
library(ggplot2)
library(ggpubr)
library(ppcor)

correlation.CE.plaque=cor.test(global.TE,global.plaque)
correlation.CE.plaque


setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create scatter plot
png(file="AprilScatter.CE.Plaque.png",width=1000,height=600)

#colors=c("#00AFBB","#B31B1B") #c("#00AFBB","#08EFFF") c("#FFC72C","#B31B1B")
data=data.frame(age=dem.data$Age[which(dem.data$Status=="MCI")], #compile all data for scatterplots
                sex=dem.data$Sex[which(dem.data$Status=="MCI")],
                icv=dem.data$ICV[which(dem.data$Status=="MCI")],
                TE=global.TE[which(dem.data$Status=="MCI")],
                entropy=(rowMeans(entropy))[which(dem.data$Status=="MCI")],
                tau=global.tau[which(dem.data$Status=="MCI")],
                plaque=global.plaque[which(dem.data$Status=="MCI")])


lm.global.plaque=lm(plaque~TE+age+sex+icv,data=data)
lm.global.plaque.estimates=summary(lm.global.plaque)$coefficients["TE","Estimate"]
lm.global.plaque.p.value=summary(lm.global.plaque)$coefficients["TE","Pr(>|t|)"]
print(paste0("Estimate: ",lm.global.plaque.estimates," | p-value: ",lm.global.plaque.p.value))

ggplot(data=data,
  aes(x=TE,y=plaque)) +
  xlim(min(data$TE),max(data$TE)) + #set x-axis limits
  geom_point(size=3,color="#00AFBB") + #point colors by status
  geom_smooth(method="lm",se=TRUE,color="#00AFBB",fill="#00AFBB",size=1.5) + #regression by status
  geom_smooth(method="lm",se=FALSE,colour="black",linetype="solid",size=2) +
  theme(axis.title=element_text(size=20), #text size
        axis.text=element_text(size=20),
        plot.title=element_text(size=20)) +
  labs(title="",x="Average Transition Energy",y="Average Amyloid Beta Plaque Level")# +
  #annotate("text",x=min(data$TE),y=max(data$plaque)+0.1,
  #         label=paste0("Estimate = ",round(lm.global.plaque.estimates,3),", p = ",
  #                      format.pval(lm.global.plaque.p.value,digits=3)),
  #         color="#00AFBB",size=5,hjust=0)

```

```{r X, warning=FALSE}

regional.TE=readMat('/Users/daraneumann/Downloads/Research/NCT/Results/Regional.Minimum.CE.mat')$regionalTE[,1,]


lm.estimates=NULL
t.estimates=NULL

dem.data$Status=as.factor(dem.data$Status)
dem.data$Sex=as.factor(dem.data$Sex)

dem.data$Status=relevel(dem.data$Status,ref="HC") #estimate > 0 indicates TE higher for MCI (MCI - HC)
dem.data$Sex=relevel(dem.data$Sex,ref="1") #females are coded as 1; estimate > 0 indicates higher TE for males (males - females)

for(i in 1:200) { #use ANOVA to test whether there is a difference, and use lm for directionality
  anova.entry=summary(aov(regional.TE[,i]~Status+Sex+Age+ICV,data=dem.data))
  results.anova=as.data.frame(anova.entry[[1]])
  
  regional.CE.status=rbind(regional.CE.status,c(results.anova$'F value'[1],results.anova$'Pr(>F)'[1]))
  regional.CE.sex=rbind(regional.CE.sex,c(results.anova$'F value'[2],results.anova$'Pr(>F)'[2]))
  regional.CE.age=rbind(regional.CE.age,c(results.anova$'F value'[3],results.anova$'Pr(>F)'[3]))
  regional.CE.icv=rbind(regional.CE.icv,c(results.anova$'F value'[4],results.anova$'Pr(>F)'[4]))
  
  lm.entry=summary(lm(regional.TE[,i]~Status+Sex+Age+ICV,data=dem.data))
  lm.estimates=rbind(lm.estimates,lm.entry$coefficients[2:3,1]) #isolate coefficients for status and sex
  
  t.entry=t.test(regional.TE[which(dem.data$Status=="MCI"),i], #t-test assumes MCI > HC
                 regional.TE[which(dem.data$Status=="HC"),i])
  t.estimates=rbind(t.estimates,t.entry$statistic)
}

#make MATLAB files to make the brain plots
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/t.Estimates.mat",labpcexport=t.estimates[,1])

lm.estimates.status=lm.estimates[,1]
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/CE.Estimates.Status.mat",labpcexport=lm.estimates.status)

lm.estimates.sex=lm.estimates[,2]
writeMat("/Users/daraneumann/Downloads/Research/NCT/Data/CE.Estimates.Sex.mat",labpcexport=lm.estimates.sex)



#identify regions that are significantly different
significant.regions=which(p.adjust(regional.CE.status[,2],n=200,method="BH")<0.05)
print(paste("Number of Regions with Significantly Different TE between MCI and HC: ",
            length(significant.regions)))

#find regions where TE_MCI > TE_HC, then display them in order of magnitude
mci.greater=significant.regions[which(t.estimates[significant.regions,]>0)]
print(paste("Number of Regions where TE_MCI is Significantly Greater than TE_HC:",
      length(mci.greater)))
print(paste("Regions (decreasing strength): ",toString(mci.greater[order(t.estimates[mci.greater,],decreasing=TRUE)])))

#find regions where TE_HC > TE_MCI, then display them in order of magnitude
hc.greater=significant.regions[which(t.estimates[significant.regions,]<0)]
print(paste("Number of Regions where TE_HC is Significantly Greater than TE_MCI:",
      length(hc.greater)))
print(paste("Regions (decreasing strength): ",toString(hc.greater[order(t.estimates[hc.greater,],decreasing=FALSE)])))
```

```{r ScatterCEPlaqueT1, warning=FALSE}

library(gridExtra)
library(ggplot2)
library(ggpubr)
library(ppcor)

global.TE.T1=readMat('/Users/daraneumann/Downloads/Research/NCT/Results/AprilGlobal.Minimum.CE.T1.mat')$globalTE

correlation.CE.plaque=cor.test(global.TE.T1,global.plaque)
correlation.CE.plaque


setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create scatter plot
png(file="AprilScatter.CE.Plaque.T1.png",width=1000,height=600)

#colors=c("#00AFBB","#B31B1B") #c("#00AFBB","#08EFFF") c("#FFC72C","#B31B1B")
data=data.frame(age=dem.data$Age[which(dem.data$Status=="MCI")], #compile all data for scatterplots
                sex=dem.data$Sex[which(dem.data$Status=="MCI")],
                icv=dem.data$ICV[which(dem.data$Status=="MCI")],
                TE=global.TE.T1[which(dem.data$Status=="MCI")],
                entropy=(rowMeans(entropy))[which(dem.data$Status=="MCI")],
                tau=global.tau[which(dem.data$Status=="MCI")],
                plaque=global.plaque[which(dem.data$Status=="MCI")])


lm.global.plaque=lm(plaque~TE+age+sex+icv,data=data)
lm.global.plaque.estimates=summary(lm.global.plaque)$coefficients["TE","Estimate"]
lm.global.plaque.p.value=summary(lm.global.plaque)$coefficients["TE","Pr(>|t|)"]
print(paste0("Estimate: ",lm.global.plaque.estimates," | p-value: ",lm.global.plaque.p.value))

ggplot(data=data,
  aes(x=TE,y=plaque)) +
  xlim(min(data$TE),max(data$TE)) + #set x-axis limits
  geom_point(size=3,color="#00AFBB") + #point colors by status
  geom_smooth(method="lm",se=TRUE,color="#00AFBB",fill="#00AFBB",size=1.5) + #regression by status
  geom_smooth(method="lm",se=FALSE,colour="black",linetype="solid",size=2) +
  theme(axis.title=element_text(size=20), #text size
        axis.text=element_text(size=20),
        plot.title=element_text(size=20)) +
  labs(title="",x="Average Transition Energy",y="Average Amyloid Beta Plaque Level")# +
  #annotate("text",x=min(data$TE),y=max(data$plaque)+0.1,
  #         label=paste0("Estimate = ",round(lm.global.plaque.estimates,3),", p = ",
  #                      format.pval(lm.global.plaque.p.value,digits=3)),
  #         color="#00AFBB",size=5,hjust=0)

```

```{r ScatterCEPlaqueBoth, warning=FALSE}

library(gridExtra)
library(ggplot2)
library(ggpubr)
library(ppcor)

global.TE=readMat('/Users/daraneumann/Downloads/Research/NCT/Results/AprilGlobal.Minimum.CE.mat')$globalTE

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create scatter plot
png(file="Scatter.CE.Plaque.Both.png",width=1000,height=600) #for supplementary figure; both MCI and HC

colors=c("#B12B8F","#00AFBB") #c("#00AFBB","#08EFFF") c("#FFC72C","#B31B1B") c("#00AFBB","#B31B1B")
data.mci=data.frame(status="MCI",
                    age=dem.data$Age[which(dem.data$Status=="MCI")], #compile all data for MCI
                    sex=dem.data$Sex[which(dem.data$Status=="MCI")],
                    icv=dem.data$ICV[which(dem.data$Status=="MCI")],
                    TE=global.TE[which(dem.data$Status=="MCI")],
                    entropy=(rowMeans(entropy))[which(dem.data$Status=="MCI")],
                    tau=global.tau[which(dem.data$Status=="MCI")],
                    plaque=global.plaque[which(dem.data$Status=="MCI")])
data.hc=data.frame(status="HC",
                   age=dem.data$Age[which(dem.data$Status=="HC")], #compile all data for HC
                   sex=dem.data$Sex[which(dem.data$Status=="HC")],
                   icv=dem.data$ICV[which(dem.data$Status=="HC")],
                   TE=global.TE[which(dem.data$Status=="HC")],
                   entropy=(rowMeans(entropy))[which(dem.data$Status=="HC")],
                   tau=global.tau[which(dem.data$Status=="HC")],
                   plaque=global.plaque[which(dem.data$Status=="HC")])


lm.global.plaque.mci=lm(plaque~TE+age+sex+icv,data=data.mci)
lm.global.plaque.estimates.mci=summary(lm.global.plaque.mci)$coefficients["TE","Estimate"]
lm.global.plaque.p.value.mci=summary(lm.global.plaque.mci)$coefficients["TE","Pr(>|t|)"]
print(paste0("Estimate: ",lm.global.plaque.estimates.mci," | p-value: ",lm.global.plaque.p.value.mci))

lm.global.plaque.hc=lm(plaque~TE+age+sex+icv,data=data.hc)
lm.global.plaque.estimates.hc=summary(lm.global.plaque.hc)$coefficients["TE","Estimate"]
lm.global.plaque.p.value.hc=summary(lm.global.plaque.hc)$coefficients["TE","Pr(>|t|)"]
print(paste0("Estimate: ",lm.global.plaque.estimates.hc," | p-value: ",lm.global.plaque.p.value.hc))

ggplot(data=rbind(data.mci,data.hc),
  aes(x=TE,y=plaque)) +
  xlim(min(data$TE),max(data$TE)) + #set x-axis limits
  geom_point(aes(color=status),size=3) + #point colors by status
  geom_smooth(method="lm",se=TRUE,aes(fill=status,color=status),size=1.5) + #regression lines
  theme(axis.title=element_text(size=20), #text size
        axis.text=element_text(size=20),
        plot.title=element_text(size=20)) +
  labs(title="",x="Average Transition Energy",y="Average Amyloid Beta Plaque Level") +
  scale_color_manual(values=c("HC"=colors[1],"MCI"=colors[2])) +
  scale_fill_manual(values=c("HC"=colors[1],"MCI"=colors[2]))

```

```{r ScatterCEPlaqueBothT1, warning=FALSE}

library(gridExtra)
library(ggplot2)
library(ggpubr)
library(ppcor)

global.TE.T1=readMat('/Users/daraneumann/Downloads/Research/NCT/Results/Global.Minimum.CE.T1.mat')$globalTE

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create scatter plot
png(file="Scatter.CE.Plaque.Both.T1.png",width=1000,height=600) #for supplementary figure; both MCI and HC

colors=c("#B12B8F","#00AFBB") #c("#00AFBB","#08EFFF") c("#FFC72C","#B31B1B") c("#00AFBB","#B31B1B")
data.mci=data.frame(status="MCI",
                    age=dem.data$Age[which(dem.data$Status=="MCI")], #compile all data for MCI
                    sex=dem.data$Sex[which(dem.data$Status=="MCI")],
                    icv=dem.data$ICV[which(dem.data$Status=="MCI")],
                    TE=global.TE.T1[which(dem.data$Status=="MCI")],
                    entropy=(rowMeans(entropy))[which(dem.data$Status=="MCI")],
                    tau=global.tau[which(dem.data$Status=="MCI")],
                    plaque=global.plaque[which(dem.data$Status=="MCI")])
data.hc=data.frame(status="HC",
                   age=dem.data$Age[which(dem.data$Status=="HC")], #compile all data for HC
                   sex=dem.data$Sex[which(dem.data$Status=="HC")],
                   icv=dem.data$ICV[which(dem.data$Status=="HC")],
                   TE=global.TE.T1[which(dem.data$Status=="HC")],
                   entropy=(rowMeans(entropy))[which(dem.data$Status=="HC")],
                   tau=global.tau[which(dem.data$Status=="HC")],
                   plaque=global.plaque[which(dem.data$Status=="HC")])


lm.global.plaque.mci=lm(plaque~TE+age+sex+icv,data=data.mci)
lm.global.plaque.estimates.mci=summary(lm.global.plaque.mci)$coefficients["TE","Estimate"]
lm.global.plaque.p.value.mci=summary(lm.global.plaque.mci)$coefficients["TE","Pr(>|t|)"]
print(paste0("Estimate: ",lm.global.plaque.estimates.mci," | p-value: ",lm.global.plaque.p.value.mci))

lm.global.plaque.hc=lm(plaque~TE+age+sex+icv,data=data.hc)
lm.global.plaque.estimates.hc=summary(lm.global.plaque.hc)$coefficients["TE","Estimate"]
lm.global.plaque.p.value.hc=summary(lm.global.plaque.hc)$coefficients["TE","Pr(>|t|)"]
print(paste0("Estimate: ",lm.global.plaque.estimates.hc," | p-value: ",lm.global.plaque.p.value.hc))

ggplot(data=rbind(data.mci,data.hc),
  aes(x=TE,y=plaque)) +
  xlim(min(data$TE),max(data$TE)) + #set x-axis limits
  geom_point(aes(color=status),size=3) + #point colors by status
  geom_smooth(method="lm",se=TRUE,aes(fill=status,color=status),size=1.5) + #regression lines
  theme(axis.title=element_text(size=20), #text size
        axis.text=element_text(size=20),
        plot.title=element_text(size=20)) +
  labs(title="",x="Average Transition Energy",y="Average Amyloid Beta Plaque Level") +
  scale_color_manual(values=c("HC"=colors[1],"MCI"=colors[2])) +
  scale_fill_manual(values=c("HC"=colors[1],"MCI"=colors[2]))

```

```{r ScatterCETau, warning=FALSE}

library(gridExtra)
library(ggplot2)
library(ggpubr)
library(ppcor)


correlation.CE.tau=cor.test(global.TE,global.tau)
correlation.CE.tau


setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create scatter plot
png(file="AprilScatter.CE.Tau.png",width=1000,height=600)

#colors=c("#00AFBB","#B31B1B") #c("#00AFBB","#08EFFF") c("#FFC72C","#B31B1B")
data=data.frame(age=dem.data$Age[which(dem.data$Status=="MCI")], #compile all data for scatterplots
                sex=dem.data$Sex[which(dem.data$Status=="MCI")],
                icv=dem.data$ICV[which(dem.data$Status=="MCI")],
                TE=global.TE[which(dem.data$Status=="MCI")],
                entropy=(rowMeans(entropy))[which(dem.data$Status=="MCI")],
                tau=global.tau[which(dem.data$Status=="MCI")],
                plaque=global.plaque[which(dem.data$Status=="MCI")])


lm.global.tau=lm(tau~TE+age+sex+icv,data=data)
lm.global.tau.estimates=summary(lm.global.tau)$coefficients["TE","Estimate"]
lm.global.tau.p.value=summary(lm.global.tau)$coefficients["TE","Pr(>|t|)"]
print(paste0("Estimate: ",lm.global.tau.estimates," | p-value: ",lm.global.tau.p.value))

ggplot(data=data,
  aes(x=TE,y=tau)) +
  xlim(min(data$TE),max(data$TE)) + #set x-axis limits
  geom_point(size=3,color="#00AFBB") + #point colors by status
  geom_smooth(method="lm",se=TRUE,color="#00AFBB",fill="#00AFBB",size=1.5) + #regression by status
  geom_smooth(method="lm",se=FALSE,colour="black",linetype="solid",size=2) +
  theme(axis.title=element_text(size=20), #text size
        axis.text=element_text(size=20),
        plot.title=element_text(size=20)) +
  labs(title="",x="Average Transition Energy",y="Average Tau Level")# +
  #annotate("text",x=min(data$TE),y=max(data$tau)+0.1,
  #         label=paste0("Estimate = ",round(lm.global.tau.estimates,3),", p = ",
  #                      format.pval(lm.global.tau.p.value,digits=3)),
  #         color="#00AFBB",size=5,hjust=0)

```

```{r ScatterCETauT1, warning=FALSE}

library(gridExtra)
library(ggplot2)
library(ggpubr)
library(ppcor)

global.TE.T1=readMat('/Users/daraneumann/Downloads/Research/NCT/Results/AprilGlobal.Minimum.CE.T1.mat')$globalTE

correlation.CE.tau=cor.test(global.TE.T1,global.tau)
correlation.CE.tau


setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create scatter plot
png(file="AprilScatter.CE.Tau.T1.png",width=1000,height=600)

#colors=c("#00AFBB","#B31B1B") #c("#00AFBB","#08EFFF") c("#FFC72C","#B31B1B")
data=data.frame(age=dem.data$Age[which(dem.data$Status=="MCI")], #compile all data for scatterplots
                sex=dem.data$Sex[which(dem.data$Status=="MCI")],
                icv=dem.data$ICV[which(dem.data$Status=="MCI")],
                TE=global.TE.T1[which(dem.data$Status=="MCI")],
                entropy=(rowMeans(entropy))[which(dem.data$Status=="MCI")],
                tau=global.tau[which(dem.data$Status=="MCI")],
                plaque=global.plaque[which(dem.data$Status=="MCI")])


lm.global.tau=lm(tau~TE+age+sex+icv,data=data)
lm.global.tau.estimates=summary(lm.global.tau)$coefficients["TE","Estimate"]
lm.global.tau.p.value=summary(lm.global.tau)$coefficients["TE","Pr(>|t|)"]
print(paste0("Estimate: ",lm.global.tau.estimates," | p-value: ",lm.global.tau.p.value))

ggplot(data=data,
  aes(x=TE,y=tau)) +
  xlim(min(data$TE),max(data$TE)) + #set x-axis limits
  geom_point(size=3,color="#00AFBB") + #point colors by status
  geom_smooth(method="lm",se=TRUE,color="#00AFBB",fill="#00AFBB",size=1.5) + #regression by status
  geom_smooth(method="lm",se=FALSE,colour="black",linetype="solid",size=2) +
  theme(axis.title=element_text(size=20), #text size
        axis.text=element_text(size=20),
        plot.title=element_text(size=20)) +
  labs(title="",x="Average Transition Energy",y="Average Tau Level")# +
  #annotate("text",x=min(data$TE),y=max(data$tau)+0.1,
  #         label=paste0("Estimate = ",round(lm.global.tau.estimates,3),", p = ",
  #                      format.pval(lm.global.tau.p.value,digits=3)),
  #         color="#00AFBB",size=5,hjust=0)

```

```{r ScatterCETauBoth, warning=FALSE}

library(gridExtra)
library(ggplot2)
library(ggpubr)
library(ppcor)

global.TE=readMat('/Users/daraneumann/Downloads/Research/NCT/Results/AprilGlobal.Minimum.CE.mat')$globalTE

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create scatter plot
png(file="Scatter.CE.Tau.Both.png",width=1000,height=600) #for supplementary figure; both MCI and HC

colors=c("#B12B8F","#00AFBB") #c("#00AFBB","#08EFFF") c("#FFC72C","#B31B1B") c("#00AFBB","#B31B1B")
data.mci=data.frame(status="MCI",
                    age=dem.data$Age[which(dem.data$Status=="MCI")], #compile all data for MCI
                    sex=dem.data$Sex[which(dem.data$Status=="MCI")],
                    icv=dem.data$ICV[which(dem.data$Status=="MCI")],
                    TE=global.TE[which(dem.data$Status=="MCI")],
                    entropy=(rowMeans(entropy))[which(dem.data$Status=="MCI")],
                    tau=global.tau[which(dem.data$Status=="MCI")],
                    plaque=global.plaque[which(dem.data$Status=="MCI")])
data.hc=data.frame(status="HC",
                   age=dem.data$Age[which(dem.data$Status=="HC")], #compile all data for HC
                   sex=dem.data$Sex[which(dem.data$Status=="HC")],
                   icv=dem.data$ICV[which(dem.data$Status=="HC")],
                   TE=global.TE[which(dem.data$Status=="HC")],
                   entropy=(rowMeans(entropy))[which(dem.data$Status=="HC")],
                   tau=global.tau[which(dem.data$Status=="HC")],
                   plaque=global.plaque[which(dem.data$Status=="HC")])


lm.global.tau.mci=lm(tau~TE+age+sex+icv,data=data.mci)
lm.global.tau.estimates.mci=summary(lm.global.tau.mci)$coefficients["TE","Estimate"]
lm.global.tau.p.value.mci=summary(lm.global.tau.mci)$coefficients["TE","Pr(>|t|)"]
print(paste0("Estimate: ",lm.global.tau.estimates.mci," | p-value: ",lm.global.tau.p.value.mci))

lm.global.tau.hc=lm(tau~TE+age+sex+icv,data=data.hc)
lm.global.tau.estimates.hc=summary(lm.global.tau.hc)$coefficients["TE","Estimate"]
lm.global.tau.p.value.hc=summary(lm.global.tau.hc)$coefficients["TE","Pr(>|t|)"]
print(paste0("Estimate: ",lm.global.tau.estimates.hc," | p-value: ",lm.global.tau.p.value.hc))

ggplot(data=rbind(data.mci,data.hc),
  aes(x=TE,y=tau)) +
  xlim(min(data$TE),max(data$TE)) + #set x-axis limits
  geom_point(aes(color=status),size=3) + #point colors by status
  geom_smooth(method="lm",se=TRUE,aes(fill=status,color=status),size=1.5) + #regression lines
  theme(axis.title=element_text(size=20), #text size
        axis.text=element_text(size=20),
        plot.title=element_text(size=20)) +
  labs(title="",x="Average Transition Energy",y="Average Tau Protein Level") +
  scale_color_manual(values=c("HC"=colors[1],"MCI"=colors[2])) +
  scale_fill_manual(values=c("HC"=colors[1],"MCI"=colors[2]))

```

```{r ScatterCETauBothT1, warning=FALSE}

library(gridExtra)
library(ggplot2)
library(ggpubr)
library(ppcor)

global.TE.T1=readMat('/Users/daraneumann/Downloads/Research/NCT/Results/Global.Minimum.CE.T1.mat')$globalTE

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create scatter plot
png(file="Scatter.CE.Tau.Both.T1.png",width=1000,height=600) #for supplementary figure; both MCI and HC

colors=c("#B12B8F","#00AFBB") #c("#00AFBB","#08EFFF") c("#FFC72C","#B31B1B") c("#00AFBB","#B31B1B")
data.mci=data.frame(status="MCI",
                    age=dem.data$Age[which(dem.data$Status=="MCI")], #compile all data for MCI
                    sex=dem.data$Sex[which(dem.data$Status=="MCI")],
                    icv=dem.data$ICV[which(dem.data$Status=="MCI")],
                    TE=global.TE.T1[which(dem.data$Status=="MCI")],
                    entropy=(rowMeans(entropy))[which(dem.data$Status=="MCI")],
                    tau=global.tau[which(dem.data$Status=="MCI")],
                    plaque=global.plaque[which(dem.data$Status=="MCI")])
data.hc=data.frame(status="HC",
                   age=dem.data$Age[which(dem.data$Status=="HC")], #compile all data for HC
                   sex=dem.data$Sex[which(dem.data$Status=="HC")],
                   icv=dem.data$ICV[which(dem.data$Status=="HC")],
                   TE=global.TE.T1[which(dem.data$Status=="HC")],
                   entropy=(rowMeans(entropy))[which(dem.data$Status=="HC")],
                   tau=global.tau[which(dem.data$Status=="HC")],
                   plaque=global.plaque[which(dem.data$Status=="HC")])


lm.global.tau.mci=lm(tau~TE+age+sex+icv,data=data.mci)
lm.global.tau.estimates.mci=summary(lm.global.tau.mci)$coefficients["TE","Estimate"]
lm.global.tau.p.value.mci=summary(lm.global.tau.mci)$coefficients["TE","Pr(>|t|)"]
print(paste0("Estimate: ",lm.global.tau.estimates.mci," | p-value: ",lm.global.tau.p.value.mci))

lm.global.tau.hc=lm(tau~TE+age+sex+icv,data=data.hc)
lm.global.tau.estimates.hc=summary(lm.global.tau.hc)$coefficients["TE","Estimate"]
lm.global.tau.p.value.hc=summary(lm.global.tau.hc)$coefficients["TE","Pr(>|t|)"]
print(paste0("Estimate: ",lm.global.tau.estimates.hc," | p-value: ",lm.global.tau.p.value.hc))

ggplot(data=rbind(data.mci,data.hc),
  aes(x=TE,y=tau)) +
  xlim(min(data$TE),max(data$TE)) + #set x-axis limits
  geom_point(aes(color=status),size=3) + #point colors by status
  geom_smooth(method="lm",se=TRUE,aes(fill=status,color=status),size=1.5) + #regression lines
  theme(axis.title=element_text(size=20), #text size
        axis.text=element_text(size=20),
        plot.title=element_text(size=20)) +
  labs(title="",x="Average Transition Energy",y="Average Tau Protein Level") +
  scale_color_manual(values=c("HC"=colors[1],"MCI"=colors[2])) +
  scale_fill_manual(values=c("HC"=colors[1],"MCI"=colors[2]))

```

##### Entropy

```{r ScatterEntropyPlauqe, warning=FALSE}

library(gridExtra)
library(ggplot2)
library(ggpubr)
library(ppcor)

correlation.entropy.plaque=cor.test(rowMeans(entropy),global.plaque)
correlation.entropy.plaque


setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create scatter plot
png(file="Scatter.Entropy.Plaque.png",width=1000,height=600)

#colors=c("#00AFBB","#B31B1B") #c("#00AFBB","#08EFFF") c("#FFC72C","#B31B1B")
data=data.frame(age=dem.data$Age[which(dem.data$Status=="MCI")], #compile all data for scatterplots
                sex=dem.data$Sex[which(dem.data$Status=="MCI")],
                icv=dem.data$ICV[which(dem.data$Status=="MCI")],
                TE=global.TE[which(dem.data$Status=="MCI")],
                entropy=(rowMeans(entropy))[which(dem.data$Status=="MCI")],
                tau=global.tau[which(dem.data$Status=="MCI")],
                plaque=global.plaque[which(dem.data$Status=="MCI")])


lm.global.plaque=lm(plaque~entropy+age+sex+icv,data=data)
lm.global.plaque.estimates=summary(lm.global.plaque)$coefficients["entropy","Estimate"]
lm.global.plaque.p.value=summary(lm.global.plaque)$coefficients["entropy","Pr(>|t|)"]
print(paste0("Estimate: ",lm.global.plaque.estimates," | p-value: ",lm.global.plaque.p.value))

ggplot(data=data,
  aes(x=entropy,y=plaque)) +
  xlim(min(data$entropy),max(data$entropy)) + #set x-axis limits
  geom_point(size=3,color="#00AFBB") + #point colors by status
  geom_smooth(method="lm",se=TRUE,color="#00AFBB",fill="#00AFBB",size=1.5) + #regression by status
  geom_smooth(method="lm",se=FALSE,colour="black",linetype="solid",size=2) +
  theme(axis.title=element_text(size=20), #text size
        axis.text=element_text(size=20),
        plot.title=element_text(size=20)) +
  labs(title="",x="Average Entropy",y="Average Amyloid Beta Plaque Level")# +
  #annotate("text",x=min(data$entropy),y=max(data$plaque)+0.1,
  #         label=paste0("Estimate = ",round(lm.global.plaque.estimates,3),", p = ",
  #                      format.pval(lm.global.plaque.p.value,digits=3)),
  #         color="#00AFBB",size=10,hjust=0)

```

```{r ScatterEntropyPlaqueBoth, warning=FALSE}

library(gridExtra)
library(ggplot2)
library(ggpubr)
library(ppcor)

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create scatter plot
png(file="Scatter.Entropy.Plaque.Both.png",width=1000,height=600) #for supplementary figure; both MCI and HC

colors=c("#B12B8F","#00AFBB") #c("#00AFBB","#08EFFF") c("#FFC72C","#B31B1B") c("#00AFBB","#B31B1B")
data.mci=data.frame(status="MCI",
                    age=dem.data$Age[which(dem.data$Status=="MCI")], #compile all data for MCI
                    sex=dem.data$Sex[which(dem.data$Status=="MCI")],
                    icv=dem.data$ICV[which(dem.data$Status=="MCI")],
                    TE=global.TE[which(dem.data$Status=="MCI")],
                    entropy=(rowMeans(entropy))[which(dem.data$Status=="MCI")],
                    tau=global.tau[which(dem.data$Status=="MCI")],
                    plaque=global.plaque[which(dem.data$Status=="MCI")])
data.hc=data.frame(status="HC",
                   age=dem.data$Age[which(dem.data$Status=="HC")], #compile all data for HC
                   sex=dem.data$Sex[which(dem.data$Status=="HC")],
                   icv=dem.data$ICV[which(dem.data$Status=="HC")],
                   TE=global.TE[which(dem.data$Status=="HC")],
                   entropy=(rowMeans(entropy))[which(dem.data$Status=="HC")],
                   tau=global.tau[which(dem.data$Status=="HC")],
                   plaque=global.plaque[which(dem.data$Status=="HC")])


lm.global.plaque.mci=lm(plaque~entropy+age+sex+icv,data=data.mci)
lm.global.plaque.estimates.mci=summary(lm.global.plaque.mci)$coefficients["entropy","Estimate"]
lm.global.plaque.p.value.mci=summary(lm.global.plaque.mci)$coefficients["entropy","Pr(>|t|)"]
print(paste0("Estimate: ",lm.global.plaque.estimates.mci," | p-value: ",lm.global.plaque.p.value.mci))

lm.global.plaque.hc=lm(plaque~entropy+age+sex+icv,data=data.hc)
lm.global.plaque.estimates.hc=summary(lm.global.plaque.hc)$coefficients["entropy","Estimate"]
lm.global.plaque.p.value.hc=summary(lm.global.plaque.hc)$coefficients["entropy","Pr(>|t|)"]
print(paste0("Estimate: ",lm.global.plaque.estimates.hc," | p-value: ",lm.global.plaque.p.value.hc))

ggplot(data=rbind(data.mci,data.hc),
  aes(x=entropy,y=plaque)) +
  xlim(min(data$entropy),max(data$entropy)) + #set x-axis limits
  geom_point(aes(color=status),size=3) + #point colors by status
  geom_smooth(method="lm",se=TRUE,aes(fill=status,color=status),size=1.5) + #regression lines
  theme(axis.title=element_text(size=20), #text size
        axis.text=element_text(size=20),
        plot.title=element_text(size=20)) +
  labs(title="",x="Average Entropy",y="Average Amyloid Beta Plaque Level") +
  scale_color_manual(values=c("HC"=colors[1],"MCI"=colors[2])) +
  scale_fill_manual(values=c("HC"=colors[1],"MCI"=colors[2]))

```

```{r ScatterEntropyTau, warning=FALSE}

library(gridExtra)
library(ggplot2)
library(ggpubr)
library(ppcor)

correlation.CE.tau=cor.test(rowMeans(entropy),global.tau)
correlation.CE.tau


setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create scatter plot
png(file="Scatter.Entropy.Tau.png",width=1000,height=600)

#colors=c("#00AFBB","#B31B1B") #c("#00AFBB","#08EFFF") c("#FFC72C","#B31B1B")
data=data.frame(age=dem.data$Age[which(dem.data$Status=="MCI")], #compile all data for scatterplots
                sex=dem.data$Sex[which(dem.data$Status=="MCI")],
                icv=dem.data$ICV[which(dem.data$Status=="MCI")],
                TE=global.TE[which(dem.data$Status=="MCI")],
                entropy=(rowMeans(entropy))[which(dem.data$Status=="MCI")],
                tau=global.tau[which(dem.data$Status=="MCI")],
                plaque=global.plaque[which(dem.data$Status=="MCI")])


lm.global.tau=lm(tau~entropy+age+sex+icv,data=data)
lm.global.tau.estimates=summary(lm.global.tau)$coefficients["entropy","Estimate"]
lm.global.tau.p.value=summary(lm.global.tau)$coefficients["entropy","Pr(>|t|)"]
print(paste0("Estimate: ",lm.global.tau.estimates," | p-value: ",lm.global.tau.p.value))

ggplot(data=data,
  aes(x=entropy,y=tau)) +
  xlim(min(data$entropy),max(data$entropy)) + #set x-axis limits
  geom_point(size=3,color="#00AFBB") + #point colors by status
  geom_smooth(method="lm",se=TRUE,color="#00AFBB",fill="#00AFBB",size=1.5) + #regression by status
  geom_smooth(method="lm",se=FALSE,colour="black",linetype="solid",size=2) +
  theme(axis.title=element_text(size=20), #text size
        axis.text=element_text(size=20),
        plot.title=element_text(size=20)) +
  labs(title="",x="Average Entropy",y="Average Tau Level")# +
  #annotate("text",x=min(data$entropy),y=max(data$tau)+0.1,
  #         label=paste0("Estimate = ",round(lm.global.tau.estimates,3),", p = ",
  #                      format.pval(lm.global.tau.p.value,digits=3)),
  #         color="#00AFBB",size=5,hjust=0)

```

```{r ScatterEntropyTauBoth, warning=FALSE}

library(gridExtra)
library(ggplot2)
library(ggpubr)
library(ppcor)

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create scatter plot
png(file="Scatter.Entropy.Tau.Both.png",width=1000,height=600) #for supplementary figure; both MCI and HC

colors=c("#B12B8F","#00AFBB") #c("#00AFBB","#08EFFF") c("#FFC72C","#B31B1B") c("#00AFBB","#B31B1B")
data.mci=data.frame(status="MCI",
                    age=dem.data$Age[which(dem.data$Status=="MCI")], #compile all data for MCI
                    sex=dem.data$Sex[which(dem.data$Status=="MCI")],
                    icv=dem.data$ICV[which(dem.data$Status=="MCI")],
                    TE=global.TE[which(dem.data$Status=="MCI")],
                    entropy=(rowMeans(entropy))[which(dem.data$Status=="MCI")],
                    tau=global.tau[which(dem.data$Status=="MCI")],
                    plaque=global.plaque[which(dem.data$Status=="MCI")])
data.hc=data.frame(status="HC",
                   age=dem.data$Age[which(dem.data$Status=="HC")], #compile all data for HC
                   sex=dem.data$Sex[which(dem.data$Status=="HC")],
                   icv=dem.data$ICV[which(dem.data$Status=="HC")],
                   TE=global.TE[which(dem.data$Status=="HC")],
                   entropy=(rowMeans(entropy))[which(dem.data$Status=="HC")],
                   tau=global.tau[which(dem.data$Status=="HC")],
                   plaque=global.plaque[which(dem.data$Status=="HC")])


lm.global.tau.mci=lm(tau~entropy+age+sex+icv,data=data.mci)
lm.global.tau.estimates.mci=summary(lm.global.tau.mci)$coefficients["entropy","Estimate"]
lm.global.tau.p.value.mci=summary(lm.global.tau.mci)$coefficients["entropy","Pr(>|t|)"]
print(paste0("Estimate: ",lm.global.tau.estimates.mci," | p-value: ",lm.global.tau.p.value.mci))

lm.global.tau.hc=lm(tau~entropy+age+sex+icv,data=data.hc)
lm.global.tau.estimates.hc=summary(lm.global.tau.hc)$coefficients["entropy","Estimate"]
lm.global.tau.p.value.hc=summary(lm.global.tau.hc)$coefficients["entropy","Pr(>|t|)"]
print(paste0("Estimate: ",lm.global.tau.estimates.hc," | p-value: ",lm.global.tau.p.value.hc))

ggplot(data=rbind(data.mci,data.hc),
  aes(x=entropy,y=tau)) +
  xlim(min(data$entropy),max(data$entropy)) + #set x-axis limits
  geom_point(aes(color=status),size=3) + #point colors by status
  geom_smooth(method="lm",se=TRUE,aes(fill=status,color=status),size=1.5) + #regression lines
  theme(axis.title=element_text(size=20), #text size
        axis.text=element_text(size=20),
        plot.title=element_text(size=20)) +
  labs(title="",x="Average Entropy",y="Average Tau Protein Level") +
  scale_color_manual(values=c("HC"=colors[1],"MCI"=colors[2])) +
  scale_fill_manual(values=c("HC"=colors[1],"MCI"=colors[2]))

```

```{r ScatterAgeCE, warning=FALSE}

library(gridExtra)
library(ggplot2)
library(ggpubr)
library(ppcor)

correlation.CE.age=cor.test(dem.data$Age,global.TE)
correlation.CE.age

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create scatter plot
png(file="Scatter.CE.Age.png",width=1000,height=600)

colors=c("#00AFBB","#B31B1B") #c("#00AFBB","#08EFFF") c("#FFC72C","#B31B1B")
data=data.frame(status=dem.data$Status, #compile all data for scatterplots
                age=dem.data$Age,
                TE=global.TE,
                entropy=rowMeans(entropy),
                tau=global.tau,
                plaque=global.plaque)

ggplot(data=data,
  aes(x=age,y=TE)) +
  geom_point(aes(color=status),size=3) + #point colors by status
  geom_smooth(method="lm",se=TRUE,aes(fill=status,color=status),size=1.5) + #regression by status
  geom_smooth(method="lm",se=FALSE,colour="black",linetype="dashed",size=2) +
  theme(axis.title=element_text(size=20), #text size
        axis.text=element_text(size=20),
        plot.title=element_text(size=20)) +
  labs(title="",x="Age",y="Average Transition Energy") +
  scale_color_manual(values=c("HC"=colors[1],"MCI"=colors[2])) +
  scale_fill_manual(values=c("HC"=colors[1],"MCI"=colors[2])) +
  stat_cor(data=data[data$status=="HC",],
           method="spearman",label.x=min(data$age),label.y=max(data$TE),
           color=colors[1],size=8,cor.coef.name="rho") +
  stat_cor(data=data[data$status=="MCI",],
           method="spearman",label.x=min(data$age),label.y=max(data$TE)-15000,
           color=colors[2],size=8,cor.coef.name="rho") +
  stat_cor(data=data,
           method="spearman",label.x=min(data$age),label.y=max(data$TE)-30000,
           color="black",size=8,cor.coef.name="rho")

```

```{r ScatterAgeEntropy, warning=FALSE}

library(gridExtra)
library(ggplot2)
library(ggpubr)
library(ppcor)

correlation.entropy.age=cor.test(dem.data$Age,rowMeans(entropy))
correlation.entropy.age

setwd("/Users/daraneumann/Downloads/Research/NCT/Results/Figures/") #create scatter plot
png(file="Scatter.Entropy.Age.png",width=1000,height=600)

colors=c("#00AFBB","#B31B1B") #c("#00AFBB","#08EFFF") c("#FFC72C","#B31B1B")
data=data.frame(status=dem.data$Status, #compile all data for scatterplots
                age=dem.data$Age,
                TE=global.TE,
                entropy=rowMeans(entropy),
                tau=global.tau,
                plaque=global.plaque)

ggplot(data=data,
  aes(x=age,y=entropy)) +
  geom_point(aes(color=status),size=3) + #point colors by status
  geom_smooth(method="lm",se=TRUE,aes(fill=status,color=status),size=1.5) + #regression by status
  geom_smooth(method="lm",se=FALSE,colour="black",linetype="dashed",size=2) +
  theme(axis.title=element_text(size=20), #text size
        axis.text=element_text(size=20),
        plot.title=element_text(size=20)) +
  labs(title="",x="Age",y="Average Regional Entropy") +
  scale_color_manual(values=c("HC"=colors[1],"MCI"=colors[2])) +
  scale_fill_manual(values=c("HC"=colors[1],"MCI"=colors[2])) +
  stat_cor(data=data[data$status=="HC",],
           method="spearman",label.x=min(data$age),label.y=max(data$entropy),
           color=colors[1],size=8,cor.coef.name="rho") +
  stat_cor(data=data[data$status=="MCI",],
           method="spearman",label.x=min(data$age),label.y=max(data$entropy)-0.08,
           color=colors[2],size=8,cor.coef.name="rho") +
  stat_cor(data=data,
           method="spearman",label.x=min(data$age),label.y=max(data$entropy)-0.16,
           color="black",size=8,cor.coef.name="rho")

```
